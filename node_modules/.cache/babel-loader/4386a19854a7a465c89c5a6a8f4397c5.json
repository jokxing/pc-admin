{"remainingRequest":"D:\\vue3\\bf_admin\\node_modules\\thread-loader\\dist\\cjs.js!D:\\vue3\\bf_admin\\node_modules\\babel-loader\\lib\\index.js!D:\\vue3\\bf_admin\\src\\assets\\js\\TCaptcha.js","dependencies":[{"path":"D:\\vue3\\bf_admin\\src\\assets\\js\\TCaptcha.js","mtime":1594180617623},{"path":"D:\\vue3\\bf_admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\vue3\\bf_admin\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\vue3\\bf_admin\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:cmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN5bWJvbCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN5bWJvbC5kZXNjcmlwdGlvbiIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN5bWJvbC5pdGVyYXRvciIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN5bWJvbC50by1zdHJpbmctdGFnIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0Iik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5kZXgtb2YiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5qb2luIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkubWFwIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc2xpY2UiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5mdW5jdGlvbi5uYW1lIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuanNvbi50by1zdHJpbmctdGFnIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMubWF0aC50by1zdHJpbmctdGFnIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMubnVtYmVyLmNvbnN0cnVjdG9yIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmdldC1vd24tcHJvcGVydHktZGVzY3JpcHRvciIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmciKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC50by1zdHJpbmciKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuaXRlcmF0b3IiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcubWF0Y2giKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcucmVwbGFjZSIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zZWFyY2giKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc3BsaXQiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLml0ZXJhdG9yIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvd2ViLnVybCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL3dlYi51cmwudG8tanNvbiIpOwoKdmFyIF90eXBlb2YyID0gcmVxdWlyZSgiRDovdnVlMy9iZl9hZG1pbi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy90eXBlb2YiKTsKCiFmdW5jdGlvbiAodCkgewogIHZhciBlID0ge307CgogIGZ1bmN0aW9uIG4ocikgewogICAgaWYgKGVbcl0pIHJldHVybiBlW3JdLmV4cG9ydHM7CiAgICB2YXIgbyA9IGVbcl0gPSB7CiAgICAgIGk6IHIsCiAgICAgIGw6ICExLAogICAgICBleHBvcnRzOiB7fQogICAgfTsKICAgIHJldHVybiB0W3JdLmNhbGwoby5leHBvcnRzLCBvLCBvLmV4cG9ydHMsIG4pLCBvLmwgPSAhMCwgby5leHBvcnRzOwogIH0KCiAgbi5tID0gdCwgbi5jID0gZSwgbi5kID0gZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIG4ubyh0LCBlKSB8fCBPYmplY3QuZGVmaW5lUHJvcGVydHkodCwgZSwgewogICAgICBlbnVtZXJhYmxlOiAhMCwKICAgICAgZ2V0OiByCiAgICB9KTsKICB9LCBuLnIgPSBmdW5jdGlvbiAodCkgewogICAgInVuZGVmaW5lZCIgIT0gdHlwZW9mIFN5bWJvbCAmJiBTeW1ib2wudG9TdHJpbmdUYWcgJiYgT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsIFN5bWJvbC50b1N0cmluZ1RhZywgewogICAgICB2YWx1ZTogIk1vZHVsZSIKICAgIH0pLCBPYmplY3QuZGVmaW5lUHJvcGVydHkodCwgIl9fZXNNb2R1bGUiLCB7CiAgICAgIHZhbHVlOiAhMAogICAgfSk7CiAgfSwgbi50ID0gZnVuY3Rpb24gKHQsIGUpIHsKICAgIGlmICgxICYgZSAmJiAodCA9IG4odCkpLCA4ICYgZSkgcmV0dXJuIHQ7CiAgICBpZiAoNCAmIGUgJiYgIm9iamVjdCIgPT0gX3R5cGVvZjIodCkgJiYgdCAmJiB0Ll9fZXNNb2R1bGUpIHJldHVybiB0OwogICAgdmFyIHIgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgaWYgKG4ucihyKSwgT2JqZWN0LmRlZmluZVByb3BlcnR5KHIsICJkZWZhdWx0IiwgewogICAgICBlbnVtZXJhYmxlOiAhMCwKICAgICAgdmFsdWU6IHQKICAgIH0pLCAyICYgZSAmJiAic3RyaW5nIiAhPSB0eXBlb2YgdCkgZm9yICh2YXIgbyBpbiB0KSB7CiAgICAgIG4uZChyLCBvLCBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiB0W2VdOwogICAgICB9LmJpbmQobnVsbCwgbykpOwogICAgfQogICAgcmV0dXJuIHI7CiAgfSwgbi5uID0gZnVuY3Rpb24gKHQpIHsKICAgIHZhciBlID0gdCAmJiB0Ll9fZXNNb2R1bGUgPyBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB0WyJkZWZhdWx0Il07CiAgICB9IDogZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gdDsKICAgIH07CiAgICByZXR1cm4gbi5kKGUsICJhIiwgZSksIGU7CiAgfSwgbi5vID0gZnVuY3Rpb24gKHQsIGUpIHsKICAgIHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwodCwgZSk7CiAgfSwgbi5wID0gIiIsIG4obi5zID0gMjApOwp9KFtmdW5jdGlvbiAodCwgZSwgbikgewogICJ1c2Ugc3RyaWN0IjsKCiAgZnVuY3Rpb24gcigpIHsKICAgIHJldHVybiBNYXRoLmZsb29yKDFlOCAqIE1hdGgucmFuZG9tKCkpOwogIH0KCiAgdmFyIG8gPSBmdW5jdGlvbiBvKHQpIHsKICAgIHQgPSB0ID8gMSA6IDA7CgogICAgdHJ5IHsKICAgICAgcmV0dXJuIHMobG9jYXRpb24uc2VhcmNoLnN1YnN0cih0KSk7CiAgICB9IGNhdGNoIChyKSB7CiAgICAgIHRyeSB7CiAgICAgICAgdmFyIGUgPSBkb2N1bWVudC5VUkwsCiAgICAgICAgICAgIG4gPSBlLmluZGV4T2YoIj8iKTsKICAgICAgICBpZiAobiA+PSAwKSByZXR1cm4gcyhlLnN1YnN0cihuICsgdCkpOwogICAgICB9IGNhdGNoIChyKSB7fQogICAgfQoKICAgIHJldHVybiAiIjsKICB9LAogICAgICBpID0ge307CgogICFmdW5jdGlvbiAoKSB7CiAgICBmb3IgKHZhciB0ID0gbyghMCkuc3BsaXQoIiYiKSwgZSA9IDA7IGUgPCB0Lmxlbmd0aDsgZSsrKSB7CiAgICAgIHZhciBuID0gLyguKj8pPSguKikvLmV4ZWModFtlXSk7CiAgICAgIG4gJiYgKGlbblsxXV0gPSBuWzJdKTsKICAgIH0KICB9KCk7CiAgdmFyIGEgPSBpLnNlc3M7CgogIGZ1bmN0aW9uIGModCkgewogICAgaS5zZXNzID0gdDsKICB9CgogIGZ1bmN0aW9uIHModCkgewogICAgdHJ5IHsKICAgICAgcmV0dXJuIGkgPyB0LnJlcGxhY2UoYSwgaS5zZXNzKSA6IHQ7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIHJldHVybiB0OwogICAgfQogIH0KCiAgd2luZG93LmNhcHRjaGFDb25maWcgJiYgd2luZG93LmNhcHRjaGFDb25maWcuc2VzcyAmJiBjKHdpbmRvdy5jYXB0Y2hhQ29uZmlnLnNlc3MpOwogIHQuZXhwb3J0cyA9IHsKICAgIGhyZWY6IGZ1bmN0aW9uIGhyZWYoKSB7CiAgICAgIHRyeSB7CiAgICAgICAgcmV0dXJuIGxvY2F0aW9uLmhyZWY7CiAgICAgIH0gY2F0Y2ggKHQpIHsKICAgICAgICB0cnkgewogICAgICAgICAgcmV0dXJuIGRvY3VtZW50LlVSTDsKICAgICAgICB9IGNhdGNoICh0KSB7fQogICAgICB9CgogICAgICByZXR1cm4gIiI7CiAgICB9LAogICAgZ2V0UXVlcnk6IGZ1bmN0aW9uIGdldFF1ZXJ5KHQpIHsKICAgICAgdmFyIGUgPSBvKCk7CiAgICAgIHJldHVybiBlID0gZSA/IGUucmVwbGFjZSgvJnJhbmQ9W14mXSsvLCAiIikgKyAiJnJhbmQ9IiArIHIoKSA6ICI/cmFuZD0iICsgcigpLCB0ID0gdCA/IDEgOiAwLCBlLnN1YnN0cih0KTsKICAgIH0sCiAgICBxdWVyeVBhcmFtOiBmdW5jdGlvbiBxdWVyeVBhcmFtKHQpIHsKICAgICAgcmV0dXJuIGlbdF07CiAgICB9LAogICAgcXVlcnlNYXA6IGZ1bmN0aW9uIHF1ZXJ5TWFwKCkgewogICAgICByZXR1cm4gJC5leHRlbmQoe30sIGkpOwogICAgfSwKICAgIHBhcnNlMnJnYjogZnVuY3Rpb24gcGFyc2UycmdiKHQpIHsKICAgICAgaWYgKCF0IHx8ICJzdHJpbmciICE9IHR5cGVvZiB0KSByZXR1cm4gbnVsbDsKICAgICAgdCA9IHQucmVwbGFjZSgvXiM/KFthLWZcZF0pKFthLWZcZF0pKFthLWZcZF0pJC9pLCBmdW5jdGlvbiAodCwgZSwgbiwgcikgewogICAgICAgIHJldHVybiBlICsgZSArIG4gKyBuICsgciArIHI7CiAgICAgIH0pOwogICAgICB2YXIgZSA9IC9eIz8oW2EtZlxkXXsyfSkoW2EtZlxkXXsyfSkoW2EtZlxkXXsyfSkkL2kuZXhlYyh0KTsKICAgICAgcmV0dXJuIGUgPyB7CiAgICAgICAgcjogcGFyc2VJbnQoZVsxXSwgMTYpLAogICAgICAgIGc6IHBhcnNlSW50KGVbMl0sIDE2KSwKICAgICAgICBiOiBwYXJzZUludChlWzNdLCAxNiksCiAgICAgICAgczogIiMiICsgZVsxXSArIGVbMl0gKyBlWzNdCiAgICAgIH0gOiBudWxsOwogICAgfSwKICAgIGFyckluZGV4T2Y6IGZ1bmN0aW9uIGFyckluZGV4T2YodCwgZSkgewogICAgICBpZiAoImZ1bmN0aW9uIiA9PSB0eXBlb2YgdC5pbmRleE9mKSByZXR1cm4gdC5pbmRleE9mKGUpOwoKICAgICAgZm9yICh2YXIgbiA9IDA7IG4gPCB0Lmxlbmd0aDsgbisrKSB7CiAgICAgICAgaWYgKHRbbl0gPT09IGUpIHJldHVybiBuOwogICAgICB9CgogICAgICByZXR1cm4gLTE7CiAgICB9LAogICAgdXBkYXRlU2Vzc2lvbjogYwogIH07Cn0sIGZ1bmN0aW9uICh0LCBlLCBuKSB7CiAgInVzZSBzdHJpY3QiOwoKICB2YXIgciA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciB0ID0gMSwKICAgICAgICBlID0gL3N1YnNpZD0oXGQrKS8uZXhlYyhsb2NhdGlvbi5ocmVmKTsKICAgIGUgJiYgKHQgPSBwYXJzZUludChlWzFdLCAxMCkgKyAxKTsKCiAgICB2YXIgbiA9IGZ1bmN0aW9uIG4oZSwgX24pIHsKICAgICAgdmFyIHIgPSBfbiB8fCB0OwogICAgICByZXR1cm4gZSA9IC9zdWJzaWQ9XGQrLy50ZXN0KGUpID8gZS5yZXBsYWNlKC9zdWJzaWQ9XGQrL2csICJzdWJzaWQ9IiArIHIpIDogZSArICImc3Vic2lkPSIgKyByLCBfbiB8fCB0KyssIGU7CiAgICB9OwoKICAgIHJldHVybiBuLmdldCA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHQ7CiAgICB9LCBuLmJpbmQgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBlID0gdCsrOwogICAgICByZXR1cm4gZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gbih0LCBlKTsKICAgICAgfTsKICAgIH0sIG47CiAgfSgpOwoKICB0LmV4cG9ydHMgPSByOwp9LCBmdW5jdGlvbiAodCwgZSwgbikgewogICJ1c2Ugc3RyaWN0IjsKCiAgdmFyIHIgPSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LAogICAgICBvID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZywKICAgICAgaSA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSwKICAgICAgYSA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IsCiAgICAgIGMgPSBmdW5jdGlvbiBjKHQpIHsKICAgIHJldHVybiAiZnVuY3Rpb24iID09IHR5cGVvZiBBcnJheS5pc0FycmF5ID8gQXJyYXkuaXNBcnJheSh0KSA6ICJbb2JqZWN0IEFycmF5XSIgPT09IG8uY2FsbCh0KTsKICB9LAogICAgICBzID0gZnVuY3Rpb24gcyh0KSB7CiAgICBpZiAoIXQgfHwgIltvYmplY3QgT2JqZWN0XSIgIT09IG8uY2FsbCh0KSkgcmV0dXJuICExOwogICAgdmFyIGUsCiAgICAgICAgbiA9IHIuY2FsbCh0LCAiY29uc3RydWN0b3IiKSwKICAgICAgICBpID0gdC5jb25zdHJ1Y3RvciAmJiB0LmNvbnN0cnVjdG9yLnByb3RvdHlwZSAmJiByLmNhbGwodC5jb25zdHJ1Y3Rvci5wcm90b3R5cGUsICJpc1Byb3RvdHlwZU9mIik7CiAgICBpZiAodC5jb25zdHJ1Y3RvciAmJiAhbiAmJiAhaSkgcmV0dXJuICExOwoKICAgIGZvciAoZSBpbiB0KSB7CiAgICAgIDsKICAgIH0KCiAgICByZXR1cm4gdm9pZCAwID09PSBlIHx8IHIuY2FsbCh0LCBlKTsKICB9LAogICAgICB1ID0gZnVuY3Rpb24gdSh0LCBlKSB7CiAgICBpICYmICJfX3Byb3RvX18iID09PSBlLm5hbWUgPyBpKHQsIGUubmFtZSwgewogICAgICBlbnVtZXJhYmxlOiAhMCwKICAgICAgY29uZmlndXJhYmxlOiAhMCwKICAgICAgdmFsdWU6IGUubmV3VmFsdWUsCiAgICAgIHdyaXRhYmxlOiAhMAogICAgfSkgOiB0W2UubmFtZV0gPSBlLm5ld1ZhbHVlOwogIH0sCiAgICAgIHAgPSBmdW5jdGlvbiBwKHQsIGUpIHsKICAgIGlmICgiX19wcm90b19fIiA9PT0gZSkgewogICAgICBpZiAoIXIuY2FsbCh0LCBlKSkgcmV0dXJuOwogICAgICBpZiAoYSkgcmV0dXJuIGEodCwgZSkudmFsdWU7CiAgICB9CgogICAgcmV0dXJuIHRbZV07CiAgfTsKCiAgdC5leHBvcnRzID0gZnVuY3Rpb24gZigpIHsKICAgIHZhciB0LAogICAgICAgIGUsCiAgICAgICAgbiwKICAgICAgICByLAogICAgICAgIG8sCiAgICAgICAgaSwKICAgICAgICBhID0gYXJndW1lbnRzWzBdLAogICAgICAgIGwgPSAxLAogICAgICAgIGQgPSBhcmd1bWVudHMubGVuZ3RoLAogICAgICAgIGggPSAhMTsKCiAgICBmb3IgKCJib29sZWFuIiA9PSB0eXBlb2YgYSAmJiAoaCA9IGEsIGEgPSBhcmd1bWVudHNbMV0gfHwge30sIGwgPSAyKSwgKG51bGwgPT0gYSB8fCAib2JqZWN0IiAhPSBfdHlwZW9mMihhKSAmJiAiZnVuY3Rpb24iICE9IHR5cGVvZiBhKSAmJiAoYSA9IHt9KTsgbCA8IGQ7ICsrbCkgewogICAgICBpZiAobnVsbCAhPSAodCA9IGFyZ3VtZW50c1tsXSkpIGZvciAoZSBpbiB0KSB7CiAgICAgICAgbiA9IHAoYSwgZSksIGEgIT09IChyID0gcCh0LCBlKSkgJiYgKGggJiYgciAmJiAocyhyKSB8fCAobyA9IGMocikpKSA/IChvID8gKG8gPSAhMSwgaSA9IG4gJiYgYyhuKSA/IG4gOiBbXSkgOiBpID0gbiAmJiBzKG4pID8gbiA6IHt9LCB1KGEsIHsKICAgICAgICAgIG5hbWU6IGUsCiAgICAgICAgICBuZXdWYWx1ZTogZihoLCBpLCByKQogICAgICAgIH0pKSA6IHZvaWQgMCAhPT0gciAmJiB1KGEsIHsKICAgICAgICAgIG5hbWU6IGUsCiAgICAgICAgICBuZXdWYWx1ZTogcgogICAgICAgIH0pKTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiBhOwogIH07Cn0sIGZ1bmN0aW9uICh0LCBlLCBuKSB7CiAgInVzZSBzdHJpY3QiOwoKICB2YXIgciwKICAgICAgbywKICAgICAgaSA9IG4oMSksCiAgICAgIGEgPSB7CiAgICBFUlJPUl9UWVBFX0ZSQU1FSlNfRE9XTkxPQURfRkFJTDogMTYsCiAgICBFUlJPUl9UWVBFX0pTT05QX1BSRUhBTkRMRTogMTcsCiAgICBFUlJPUl9UWVBFX0ZSQU1FSlNfQ09ERV9FUlJPUjogMTgsCiAgICBDQUxMQkFDS19OQU1FOiAxOQogIH0sCiAgICAgIGMgPSB7CiAgICBFUlJPUl9UWVBFX0ZSQU1FSlNfRE9XTkxPQURfRkFJTDogIkVSUk9SX1RZUEVfRlJBTUVKU19ET1dOTE9BRF9GQUlMIiwKICAgIEVSUk9SX1RZUEVfSlNPTlBfUFJFSEFORExFOiAiRVJST1JfVFlQRV9KU09OUF9QUkVIQU5ETEUiLAogICAgRVJST1JfVFlQRV9GUkFNRUpTX0NPREVfRVJST1I6ICJFUlJPUl9UWVBFX0ZSQU1FSlNfQ09ERV9FUlJPUiIsCiAgICBDQUxMQkFDS19OQU1FOiAiQ0FMTEJBQ0tfTkFNRSIKICB9LAogICAgICBzID0gKHIgPSBkb2N1bWVudC5yZWZlcnJlciwgbyA9IGxvY2F0aW9uLmhyZWYgfHwgZG9jdW1lbnQuVVJMLCByID0gci5sZW5ndGggPiA1MTIgPyByLnN1YnN0cigwLCA1MTIpIDogciwgbyA9IG8ubGVuZ3RoID4gMTAyNCA/IG8uc3Vic3RyKDAsIDEwMjQpIDogbywgWyJyZWZlcmVyPSIgKyBlbmNvZGVVUklDb21wb25lbnQociksICJocmVmPSIgKyBlbmNvZGVVUklDb21wb25lbnQobyldLmpvaW4oIiYiKSk7CiAgdC5leHBvcnRzID0gewogICAgdHlwZTogYSwKICAgIHNlbmQ6IGZ1bmN0aW9uIHNlbmQodCwgZSwgbikgewogICAgICB0cnkgewogICAgICAgIChuID0gbiB8fCBjW3RdKS5sZW5ndGggPiAxMDI0ICYmIG4uc3Vic3RyKDAsIDEwMjQpOwogICAgICAgIHZhciByID0gWyJ0eXBlPSIgKyAodCA9IGFbdF0pLCAiYXBwaWQ9IiArIGUsICJyZWFzb249IiArIGVuY29kZVVSSUNvbXBvbmVudChuKV0sCiAgICAgICAgICAgIG8gPSAiaHR0cHM6Ly9hcS5xcS5jb20vY24yL21hbmFnZS9tYnRva2VuL2NhcF9tb25pdG9yPyIgKyBzICsgIiYiICsgci5qb2luKCImIik7CiAgICAgICAgbmV3IEltYWdlKCkuc3JjID0gaShvKTsKICAgICAgfSBjYXRjaCAodSkge30KICAgIH0sCiAgICBwZXJmZWN0U3RhY2s6IGZ1bmN0aW9uIHBlcmZlY3RTdGFjayh0KSB7CiAgICAgIHZhciBlID0gIiI7CiAgICAgIHQgJiYgdC5zdGFjayAmJiAoZSA9IHQuc3RhY2sucmVwbGFjZSgvXG4vZ2ksICIiKS5zcGxpdCgvXGJhdFxiLykuam9pbigiXG4iKS5yZXBsYWNlKC9cP1teOl0rL2dpLCAiIikpOwoKICAgICAgdHJ5IHsKICAgICAgICB2YXIgbiA9IHQudG9TdHJpbmcoKTsKICAgICAgICBlLmluZGV4T2YobikgPCAwICYmIChlID0gbiArICJAIiArIGUpOwogICAgICB9IGNhdGNoIChyKSB7fQoKICAgICAgcmV0dXJuIGU7CiAgICB9CiAgfTsKfSwsLCwgZnVuY3Rpb24gKHQsIGUsIG4pIHsKICAidXNlIHN0cmljdCI7CgogIHQuZXhwb3J0cyA9IHsKICAgIGFkZDogZnVuY3Rpb24gYWRkKHQsIGUsIG4pIHsKICAgICAgdCAmJiAodC5hZGRFdmVudExpc3RlbmVyID8gdC5hZGRFdmVudExpc3RlbmVyKGUsIG4sICExKSA6IHQuYXR0YWNoRXZlbnQgPyB0LmF0dGFjaEV2ZW50KCJvbiIgKyBlLCBuKSA6IHRbIm9uIiArIGVdID0gbik7CiAgICB9LAogICAgcmVtb3ZlOiBmdW5jdGlvbiByZW1vdmUodCwgZSwgbikgewogICAgICB0ICYmICh0LnJlbW92ZUV2ZW50TGlzdGVuZXIgPyB0LnJlbW92ZUV2ZW50TGlzdGVuZXIoZSwgbiwgITEpIDogdC5kZXRhY2hFdmVudCA/IHQuZGV0YWNoRXZlbnQoIm9uIiArIGUsIG4pIDogdFsib24iICsgZV0gPSBudWxsKTsKICAgIH0KICB9Owp9LCwgZnVuY3Rpb24gKHQsIGUpIHsKICB0LmV4cG9ydHMgPSBmdW5jdGlvbiAodCkgewogICAgdmFyIGUgPSBbXTsKICAgIHJldHVybiBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gdGhpcy5tYXAoZnVuY3Rpb24gKGUpIHsKICAgICAgICB2YXIgbiA9IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgICB2YXIgbiA9IHRbMV0gfHwgIiIsCiAgICAgICAgICAgICAgciA9IHRbM107CiAgICAgICAgICBpZiAoIXIpIHJldHVybiBuOwoKICAgICAgICAgIGlmIChlICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIGJ0b2EpIHsKICAgICAgICAgICAgdmFyIG8gPSAoYSA9IHIsICIvKiMgc291cmNlTWFwcGluZ1VSTD1kYXRhOmFwcGxpY2F0aW9uL2pzb247Y2hhcnNldD11dGYtODtiYXNlNjQsIiArIGJ0b2EodW5lc2NhcGUoZW5jb2RlVVJJQ29tcG9uZW50KEpTT04uc3RyaW5naWZ5KGEpKSkpICsgIiAqLyIpLAogICAgICAgICAgICAgICAgaSA9IHIuc291cmNlcy5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICByZXR1cm4gIi8qIyBzb3VyY2VVUkw9IiArIHIuc291cmNlUm9vdCArIHQgKyAiICovIjsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiBbbl0uY29uY2F0KGkpLmNvbmNhdChbb10pLmpvaW4oIlxuIik7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGE7CiAgICAgICAgICByZXR1cm4gW25dLmpvaW4oIlxuIik7CiAgICAgICAgfShlLCB0KTsKCiAgICAgICAgcmV0dXJuIGVbMl0gPyAiQG1lZGlhICIgKyBlWzJdICsgInsiICsgbiArICJ9IiA6IG47CiAgICAgIH0pLmpvaW4oIiIpOwogICAgfSwgZS5pID0gZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgInN0cmluZyIgPT0gdHlwZW9mIHQgJiYgKHQgPSBbW251bGwsIHQsICIiXV0pOwoKICAgICAgZm9yICh2YXIgciA9IHt9LCBvID0gMDsgbyA8IHRoaXMubGVuZ3RoOyBvKyspIHsKICAgICAgICB2YXIgaSA9IHRoaXNbb11bMF07CiAgICAgICAgIm51bWJlciIgPT0gdHlwZW9mIGkgJiYgKHJbaV0gPSAhMCk7CiAgICAgIH0KCiAgICAgIGZvciAobyA9IDA7IG8gPCB0Lmxlbmd0aDsgbysrKSB7CiAgICAgICAgdmFyIGEgPSB0W29dOwogICAgICAgICJudW1iZXIiID09IHR5cGVvZiBhWzBdICYmIHJbYVswXV0gfHwgKG4gJiYgIWFbMl0gPyBhWzJdID0gbiA6IG4gJiYgKGFbMl0gPSAiKCIgKyBhWzJdICsgIikgYW5kICgiICsgbiArICIpIiksIGUucHVzaChhKSk7CiAgICAgIH0KICAgIH0sIGU7CiAgfTsKfSwgZnVuY3Rpb24gKHQsIGUpIHsKICB2YXIgbiA9IHt9LAogICAgICByID0gZnVuY3Rpb24gcih0KSB7CiAgICB2YXIgZTsKICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB2b2lkIDAgPT09IGUgJiYgKGUgPSB0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpLCBlOwogICAgfTsKICB9LAogICAgICBvID0gcihmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gL21zaWUgWzYtOV1cYi8udGVzdCh3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpKTsKICB9KSwKICAgICAgaSA9IHIoZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIGRvY3VtZW50LmhlYWQgfHwgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImhlYWQiKVswXTsKICB9KSwKICAgICAgYSA9IG51bGwsCiAgICAgIGMgPSAwOwoKICBmdW5jdGlvbiBzKHQsIGUpIHsKICAgIGZvciAodmFyIHIgPSAwOyByIDwgdC5sZW5ndGg7IHIrKykgewogICAgICB2YXIgbyA9IHRbcl0sCiAgICAgICAgICBpID0gbltvLmlkXTsKCiAgICAgIGlmIChpKSB7CiAgICAgICAgaS5yZWZzKys7CgogICAgICAgIGZvciAodmFyIGEgPSAwOyBhIDwgaS5wYXJ0cy5sZW5ndGg7IGErKykgewogICAgICAgICAgaS5wYXJ0c1thXShvLnBhcnRzW2FdKTsKICAgICAgICB9CgogICAgICAgIGZvciAoOyBhIDwgby5wYXJ0cy5sZW5ndGg7IGErKykgewogICAgICAgICAgaS5wYXJ0cy5wdXNoKGwoby5wYXJ0c1thXSwgZSkpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgYyA9IFtdOwoKICAgICAgICBmb3IgKGEgPSAwOyBhIDwgby5wYXJ0cy5sZW5ndGg7IGErKykgewogICAgICAgICAgYy5wdXNoKGwoby5wYXJ0c1thXSwgZSkpOwogICAgICAgIH0KCiAgICAgICAgbltvLmlkXSA9IHsKICAgICAgICAgIGlkOiBvLmlkLAogICAgICAgICAgcmVmczogMSwKICAgICAgICAgIHBhcnRzOiBjCiAgICAgICAgfTsKICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gdSh0KSB7CiAgICBmb3IgKHZhciBlID0gW10sIG4gPSB7fSwgciA9IDA7IHIgPCB0Lmxlbmd0aDsgcisrKSB7CiAgICAgIHZhciBvID0gdFtyXSwKICAgICAgICAgIGkgPSBvWzBdLAogICAgICAgICAgYSA9IHsKICAgICAgICBjc3M6IG9bMV0sCiAgICAgICAgbWVkaWE6IG9bMl0sCiAgICAgICAgc291cmNlTWFwOiBvWzNdCiAgICAgIH07CiAgICAgIG5baV0gPyBuW2ldLnBhcnRzLnB1c2goYSkgOiBlLnB1c2gobltpXSA9IHsKICAgICAgICBpZDogaSwKICAgICAgICBwYXJ0czogW2FdCiAgICAgIH0pOwogICAgfQoKICAgIHJldHVybiBlOwogIH0KCiAgZnVuY3Rpb24gcCh0LCBlKSB7CiAgICB2YXIgbiA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMik7CiAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICB2YXIgciA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cyk7CiAgICAgIHQuYXBwbHkoZSwgbi5jb25jYXQocikpOwogICAgfTsKICB9CgogIGZ1bmN0aW9uIGYoKSB7CiAgICB2YXIgdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInN0eWxlIiksCiAgICAgICAgZSA9IGkoKTsKICAgIHJldHVybiB0LnR5cGUgPSAidGV4dC9jc3MiLCBlLmFwcGVuZENoaWxkKHQpLCB0OwogIH0KCiAgZnVuY3Rpb24gbCh0LCBlKSB7CiAgICB2YXIgbiwgciwgbywgcywgdTsKCiAgICBpZiAoZS5zaW5nbGV0b24pIHsKICAgICAgdmFyIGwgPSBjKys7CiAgICAgIG4gPSBhIHx8IChhID0gZigpKSwgciA9IHAoeSwgbnVsbCwgbiwgbCwgITEpLCBvID0gcCh5LCBudWxsLCBuLCBsLCAhMCk7CiAgICB9IGVsc2UgdC5zb3VyY2VNYXAgJiYgImZ1bmN0aW9uIiA9PSB0eXBlb2YgVVJMICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIFVSTC5jcmVhdGVPYmplY3RVUkwgJiYgImZ1bmN0aW9uIiA9PSB0eXBlb2YgVVJMLnJldm9rZU9iamVjdFVSTCAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiBCbG9iICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIGJ0b2EgPyAocyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImxpbmsiKSwgdSA9IGkoKSwgcy5yZWwgPSAic3R5bGVzaGVldCIsIHUuYXBwZW5kQ2hpbGQocyksIHIgPSBwKG0sIG51bGwsIG4gPSBzKSwgbyA9IGZ1bmN0aW9uIG8oKSB7CiAgICAgIG4ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChuKSwgbi5ocmVmICYmIFVSTC5yZXZva2VPYmplY3RVUkwobi5ocmVmKTsKICAgIH0pIDogKG4gPSBmKCksIHIgPSBwKGIsIG51bGwsIG4pLCBvID0gZnVuY3Rpb24gbygpIHsKICAgICAgbi5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG4pOwogICAgfSk7CgogICAgcmV0dXJuIHIodCksIGZ1bmN0aW9uIChlKSB7CiAgICAgIGlmIChlKSB7CiAgICAgICAgaWYgKGUuY3NzID09PSB0LmNzcyAmJiBlLm1lZGlhID09PSB0Lm1lZGlhICYmIGUuc291cmNlTWFwID09PSB0LnNvdXJjZU1hcCkgcmV0dXJuOwogICAgICAgIHIodCA9IGUpOwogICAgICB9IGVsc2UgbygpOwogICAgfTsKICB9CgogIHQuZXhwb3J0cyA9IGZ1bmN0aW9uICh0LCBlKSB7CiAgICBpZiAoInVuZGVmaW5lZCIgIT0gdHlwZW9mIERFQlVHICYmIERFQlVHICYmICJvYmplY3QiICE9ICh0eXBlb2YgZG9jdW1lbnQgPT09ICJ1bmRlZmluZWQiID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mMihkb2N1bWVudCkpKSB0aHJvdyBuZXcgRXJyb3IoIlRoZSBzdHlsZS1sb2FkZXIgY2Fubm90IGJlIHVzZWQgaW4gYSBub24tYnJvd3NlciBlbnZpcm9ubWVudCIpOwogICAgInVuZGVmaW5lZCIgPT0gdHlwZW9mIChlID0gZSB8fCB7fSkuc2luZ2xldG9uICYmIChlLnNpbmdsZXRvbiA9IG8oKSk7CiAgICB2YXIgciA9IHUodCk7CiAgICByZXR1cm4gcyhyLCBlKSwgZnVuY3Rpb24gKHQpIHsKICAgICAgZm9yICh2YXIgbyA9IFtdLCBpID0gMDsgaSA8IHIubGVuZ3RoOyBpKyspIHsKICAgICAgICB2YXIgYSA9IHJbaV07CiAgICAgICAgKGMgPSBuW2EuaWRdKS5yZWZzLS0sIG8ucHVzaChjKTsKICAgICAgfQoKICAgICAgdCAmJiBzKHUodCksIGUpOwoKICAgICAgZm9yIChpID0gMDsgaSA8IG8ubGVuZ3RoOyBpKyspIHsKICAgICAgICB2YXIgYzsKCiAgICAgICAgaWYgKDAgPT09IChjID0gb1tpXSkucmVmcykgewogICAgICAgICAgZm9yICh2YXIgcCA9IDA7IHAgPCBjLnBhcnRzLmxlbmd0aDsgcCsrKSB7CiAgICAgICAgICAgIGMucGFydHNbcF0oKTsKICAgICAgICAgIH0KCiAgICAgICAgICBkZWxldGUgbltjLmlkXTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CiAgfTsKCiAgdmFyIGQsCiAgICAgIGggPSAoZCA9IFtdLCBmdW5jdGlvbiAodCwgZSkgewogICAgdmFyIG4gPSBbXTsKICAgIGRbdF0gPSBlOwoKICAgIGZvciAodmFyIHIgPSAwOyByIDwgZC5sZW5ndGg7IHIrKykgewogICAgICBkW3JdICYmIG4ucHVzaChkW3JdKTsKICAgIH0KCiAgICByZXR1cm4gbi5qb2luKCJcbiIpOwogIH0pOwoKICBmdW5jdGlvbiB5KHQsIGUsIG4sIHIpIHsKICAgIHZhciBvID0gbiA/ICIiIDogci5jc3M7CiAgICBpZiAodC5zdHlsZVNoZWV0KSB0LnN0eWxlU2hlZXQuY3NzVGV4dCA9IGgoZSwgbyk7ZWxzZSB7CiAgICAgIHZhciBpID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUobyksCiAgICAgICAgICBhID0gdC5jaGlsZE5vZGVzOwogICAgICBhW2VdICYmIHQucmVtb3ZlQ2hpbGQoYVtlXSksIGEubGVuZ3RoID8gdC5pbnNlcnRCZWZvcmUoaSwgYVtlXSkgOiB0LmFwcGVuZENoaWxkKGkpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gYih0LCBlKSB7CiAgICB2YXIgbiA9IGUuY3NzLAogICAgICAgIHIgPSBlLm1lZGlhOwogICAgZS5zb3VyY2VNYXA7CiAgICBpZiAociAmJiB0LnNldEF0dHJpYnV0ZSgibWVkaWEiLCByKSwgdC5zdHlsZVNoZWV0KSB0LnN0eWxlU2hlZXQuY3NzVGV4dCA9IG47ZWxzZSB7CiAgICAgIGZvciAoOyB0LmZpcnN0Q2hpbGQ7KSB7CiAgICAgICAgdC5yZW1vdmVDaGlsZCh0LmZpcnN0Q2hpbGQpOwogICAgICB9CgogICAgICB0LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKG4pKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIG0odCwgZSkgewogICAgdmFyIG4gPSBlLmNzcywKICAgICAgICByID0gKGUubWVkaWEsIGUuc291cmNlTWFwKTsKICAgIHIgJiYgKG4gKz0gIlxuLyojIHNvdXJjZU1hcHBpbmdVUkw9ZGF0YTphcHBsaWNhdGlvbi9qc29uO2Jhc2U2NCwiICsgYnRvYSh1bmVzY2FwZShlbmNvZGVVUklDb21wb25lbnQoSlNPTi5zdHJpbmdpZnkocikpKSkgKyAiICovIik7CiAgICB2YXIgbyA9IG5ldyBCbG9iKFtuXSwgewogICAgICB0eXBlOiAidGV4dC9jc3MiCiAgICB9KSwKICAgICAgICBpID0gdC5ocmVmOwogICAgdC5ocmVmID0gVVJMLmNyZWF0ZU9iamVjdFVSTChvKSwgaSAmJiBVUkwucmV2b2tlT2JqZWN0VVJMKGkpOwogIH0KfSwgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICJ1c2Ugc3RyaWN0IjsKCiAgdmFyIF90eXBlb2YgPSAiZnVuY3Rpb24iID09IHR5cGVvZiBTeW1ib2wgJiYgInN5bWJvbCIgPT0gX3R5cGVvZjIoU3ltYm9sLml0ZXJhdG9yKSA/IGZ1bmN0aW9uICh0KSB7CiAgICByZXR1cm4gX3R5cGVvZjIodCk7CiAgfSA6IGZ1bmN0aW9uICh0KSB7CiAgICByZXR1cm4gdCAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiBTeW1ib2wgJiYgdC5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIHQgIT09IFN5bWJvbC5wcm90b3R5cGUgPyAic3ltYm9sIiA6IF90eXBlb2YyKHQpOwogIH07CgogICJvYmplY3QiICE9PSAoInVuZGVmaW5lZCIgPT0gdHlwZW9mIEpTT04gPyAidW5kZWZpbmVkIiA6IF90eXBlb2YoSlNPTikpICYmIChKU09OID0ge30pLCBmdW5jdGlvbiAoKSB7CiAgICB2YXIgcnhfb25lID0gL15bXF0sOnt9XHNdKiQvLAogICAgICAgIHJ4X3R3byA9IC9cXCg/OlsiXFxcL2JmbnJ0XXx1WzAtOWEtZkEtRl17NH0pL2csCiAgICAgICAgcnhfdGhyZWUgPSAvIlteIlxcXG5ccl0qInx0cnVlfGZhbHNlfG51bGx8LT9cZCsoPzpcLlxkKik/KD86W2VFXVsrXC1dP1xkKyk/L2csCiAgICAgICAgcnhfZm91ciA9IC8oPzpefDp8LCkoPzpccypcWykrL2csCiAgICAgICAgcnhfZXNjYXBhYmxlID0gL1tcXCJcdTAwMDAtXHUwMDFmXHUwMDdmLVx1MDA5Zlx1MDBhZFx1MDYwMC1cdTA2MDRcdTA3MGZcdTE3YjRcdTE3YjVcdTIwMGMtXHUyMDBmXHUyMDI4LVx1MjAyZlx1MjA2MC1cdTIwNmZcdWZlZmZcdWZmZjAtXHVmZmZmXS9nLAogICAgICAgIHJ4X2Rhbmdlcm91cyA9IC9bXHUwMDAwXHUwMGFkXHUwNjAwLVx1MDYwNFx1MDcwZlx1MTdiNFx1MTdiNVx1MjAwYy1cdTIwMGZcdTIwMjgtXHUyMDJmXHUyMDYwLVx1MjA2Zlx1ZmVmZlx1ZmZmMC1cdWZmZmZdL2csCiAgICAgICAgZ2FwLAogICAgICAgIGluZGVudCwKICAgICAgICBtZXRhLAogICAgICAgIHJlcDsKCiAgICBmdW5jdGlvbiBmKHQpIHsKICAgICAgcmV0dXJuIHQgPCAxMCA/ICIwIiArIHQgOiB0OwogICAgfQoKICAgIGZ1bmN0aW9uIHRoaXNfdmFsdWUoKSB7CiAgICAgIHJldHVybiB0aGlzLnZhbHVlT2YoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBxdW90ZSh0KSB7CiAgICAgIHJldHVybiByeF9lc2NhcGFibGUubGFzdEluZGV4ID0gMCwgcnhfZXNjYXBhYmxlLnRlc3QodCkgPyAnIicgKyB0LnJlcGxhY2UocnhfZXNjYXBhYmxlLCBmdW5jdGlvbiAodCkgewogICAgICAgIHZhciBlID0gbWV0YVt0XTsKICAgICAgICByZXR1cm4gInN0cmluZyIgPT0gdHlwZW9mIGUgPyBlIDogIlxcdSIgKyAoIjAwMDAiICsgdC5jaGFyQ29kZUF0KDApLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTQpOwogICAgICB9KSArICciJyA6ICciJyArIHQgKyAnIic7CiAgICB9CgogICAgZnVuY3Rpb24gc3RyKHQsIGUpIHsKICAgICAgdmFyIG4sCiAgICAgICAgICByLAogICAgICAgICAgbywKICAgICAgICAgIGksCiAgICAgICAgICBhLAogICAgICAgICAgYyA9IGdhcCwKICAgICAgICAgIHMgPSBlW3RdOwoKICAgICAgc3dpdGNoIChzICYmICJvYmplY3QiID09PSAodm9pZCAwID09PSBzID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mKHMpKSAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiBzLnRvSlNPTiAmJiAocyA9IHMudG9KU09OKHQpKSwgImZ1bmN0aW9uIiA9PSB0eXBlb2YgcmVwICYmIChzID0gcmVwLmNhbGwoZSwgdCwgcykpLCB2b2lkIDAgPT09IHMgPyAidW5kZWZpbmVkIiA6IF90eXBlb2YocykpIHsKICAgICAgICBjYXNlICJzdHJpbmciOgogICAgICAgICAgcmV0dXJuIHF1b3RlKHMpOwoKICAgICAgICBjYXNlICJudW1iZXIiOgogICAgICAgICAgcmV0dXJuIGlzRmluaXRlKHMpID8gU3RyaW5nKHMpIDogIm51bGwiOwoKICAgICAgICBjYXNlICJib29sZWFuIjoKICAgICAgICBjYXNlICJudWxsIjoKICAgICAgICAgIHJldHVybiBTdHJpbmcocyk7CgogICAgICAgIGNhc2UgIm9iamVjdCI6CiAgICAgICAgICBpZiAoIXMpIHJldHVybiAibnVsbCI7CgogICAgICAgICAgaWYgKGdhcCArPSBpbmRlbnQsIGEgPSBbXSwgIltvYmplY3QgQXJyYXldIiA9PT0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5hcHBseShzKSkgewogICAgICAgICAgICBmb3IgKGkgPSBzLmxlbmd0aCwgbiA9IDA7IG4gPCBpOyBuICs9IDEpIHsKICAgICAgICAgICAgICBhW25dID0gc3RyKG4sIHMpIHx8ICJudWxsIjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIG8gPSAwID09PSBhLmxlbmd0aCA/ICJbXSIgOiBnYXAgPyAiW1xuIiArIGdhcCArIGEuam9pbigiLFxuIiArIGdhcCkgKyAiXG4iICsgYyArICJdIiA6ICJbIiArIGEuam9pbigiLCIpICsgIl0iLCBnYXAgPSBjLCBvOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChyZXAgJiYgIm9iamVjdCIgPT09ICh2b2lkIDAgPT09IHJlcCA/ICJ1bmRlZmluZWQiIDogX3R5cGVvZihyZXApKSkgZm9yIChpID0gcmVwLmxlbmd0aCwgbiA9IDA7IG4gPCBpOyBuICs9IDEpIHsKICAgICAgICAgICAgInN0cmluZyIgPT0gdHlwZW9mIHJlcFtuXSAmJiAobyA9IHN0cihyID0gcmVwW25dLCBzKSkgJiYgYS5wdXNoKHF1b3RlKHIpICsgKGdhcCA/ICI6ICIgOiAiOiIpICsgbyk7CiAgICAgICAgICB9IGVsc2UgZm9yIChyIGluIHMpIHsKICAgICAgICAgICAgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHMsIHIpICYmIChvID0gc3RyKHIsIHMpKSAmJiBhLnB1c2gocXVvdGUocikgKyAoZ2FwID8gIjogIiA6ICI6IikgKyBvKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBvID0gMCA9PT0gYS5sZW5ndGggPyAie30iIDogZ2FwID8gIntcbiIgKyBnYXAgKyBhLmpvaW4oIixcbiIgKyBnYXApICsgIlxuIiArIGMgKyAifSIgOiAieyIgKyBhLmpvaW4oIiwiKSArICJ9IiwgZ2FwID0gYywgbzsKICAgICAgfQogICAgfQoKICAgICJmdW5jdGlvbiIgIT0gdHlwZW9mIERhdGUucHJvdG90eXBlLnRvSlNPTiAmJiAoRGF0ZS5wcm90b3R5cGUudG9KU09OID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gaXNGaW5pdGUodGhpcy52YWx1ZU9mKCkpID8gdGhpcy5nZXRVVENGdWxsWWVhcigpICsgIi0iICsgZih0aGlzLmdldFVUQ01vbnRoKCkgKyAxKSArICItIiArIGYodGhpcy5nZXRVVENEYXRlKCkpICsgIlQiICsgZih0aGlzLmdldFVUQ0hvdXJzKCkpICsgIjoiICsgZih0aGlzLmdldFVUQ01pbnV0ZXMoKSkgKyAiOiIgKyBmKHRoaXMuZ2V0VVRDU2Vjb25kcygpKSArICJaIiA6IG51bGw7CiAgICB9LCBCb29sZWFuLnByb3RvdHlwZS50b0pTT04gPSB0aGlzX3ZhbHVlLCBOdW1iZXIucHJvdG90eXBlLnRvSlNPTiA9IHRoaXNfdmFsdWUsIFN0cmluZy5wcm90b3R5cGUudG9KU09OID0gdGhpc192YWx1ZSksICJmdW5jdGlvbiIgIT0gdHlwZW9mIEpTT04uc3RyaW5naWZ5ICYmIChtZXRhID0gewogICAgICAiXGIiOiAiXFxiIiwKICAgICAgIlx0IjogIlxcdCIsCiAgICAgICJcbiI6ICJcXG4iLAogICAgICAiXGYiOiAiXFxmIiwKICAgICAgIlxyIjogIlxcciIsCiAgICAgICciJzogJ1xcIicsCiAgICAgICJcXCI6ICJcXFxcIgogICAgfSwgSlNPTi5zdHJpbmdpZnkgPSBmdW5jdGlvbiAodCwgZSwgbikgewogICAgICB2YXIgcjsKICAgICAgaWYgKGdhcCA9ICIiLCBpbmRlbnQgPSAiIiwgIm51bWJlciIgPT0gdHlwZW9mIG4pIGZvciAociA9IDA7IHIgPCBuOyByICs9IDEpIHsKICAgICAgICBpbmRlbnQgKz0gIiAiOwogICAgICB9IGVsc2UgInN0cmluZyIgPT0gdHlwZW9mIG4gJiYgKGluZGVudCA9IG4pOwogICAgICBpZiAocmVwID0gZSwgZSAmJiAiZnVuY3Rpb24iICE9IHR5cGVvZiBlICYmICgib2JqZWN0IiAhPT0gKHZvaWQgMCA9PT0gZSA/ICJ1bmRlZmluZWQiIDogX3R5cGVvZihlKSkgfHwgIm51bWJlciIgIT0gdHlwZW9mIGUubGVuZ3RoKSkgdGhyb3cgbmV3IEVycm9yKCJKU09OLnN0cmluZ2lmeSIpOwogICAgICByZXR1cm4gc3RyKCIiLCB7CiAgICAgICAgIiI6IHQKICAgICAgfSk7CiAgICB9KSwgImZ1bmN0aW9uIiAhPSB0eXBlb2YgSlNPTi5wYXJzZSAmJiAoSlNPTi5wYXJzZSA9IGZ1bmN0aW9uICh0ZXh0LCByZXZpdmVyKSB7CiAgICAgIHZhciBqOwoKICAgICAgZnVuY3Rpb24gd2Fsayh0LCBlKSB7CiAgICAgICAgdmFyIG4sCiAgICAgICAgICAgIHIsCiAgICAgICAgICAgIG8gPSB0W2VdOwogICAgICAgIGlmIChvICYmICJvYmplY3QiID09PSAodm9pZCAwID09PSBvID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mKG8pKSkgZm9yIChuIGluIG8pIHsKICAgICAgICAgIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvLCBuKSAmJiAoKHIgPSB3YWxrKG8sIG4pKSAhPT0gdW5kZWZpbmVkID8gb1tuXSA9IHIgOiBkZWxldGUgb1tuXSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXZpdmVyLmNhbGwodCwgZSwgbyk7CiAgICAgIH0KCiAgICAgIGlmICh0ZXh0ID0gU3RyaW5nKHRleHQpLCByeF9kYW5nZXJvdXMubGFzdEluZGV4ID0gMCwgcnhfZGFuZ2Vyb3VzLnRlc3QodGV4dCkgJiYgKHRleHQgPSB0ZXh0LnJlcGxhY2UocnhfZGFuZ2Vyb3VzLCBmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiAiXFx1IiArICgiMDAwMCIgKyB0LmNoYXJDb2RlQXQoMCkudG9TdHJpbmcoMTYpKS5zbGljZSgtNCk7CiAgICAgIH0pKSwgcnhfb25lLnRlc3QodGV4dC5yZXBsYWNlKHJ4X3R3bywgIkAiKS5yZXBsYWNlKHJ4X3RocmVlLCAiXSIpLnJlcGxhY2UocnhfZm91ciwgIiIpKSkgcmV0dXJuIGogPSBldmFsKCIoIiArIHRleHQgKyAiKSIpLCAiZnVuY3Rpb24iID09IHR5cGVvZiByZXZpdmVyID8gd2Fsayh7CiAgICAgICAgIiI6IGoKICAgICAgfSwgIiIpIDogajsKICAgICAgdGhyb3cgbmV3IFN5bnRheEVycm9yKCJKU09OLnBhcnNlIik7CiAgICB9KTsKICB9KCk7Cn0sIGZ1bmN0aW9uICh0LCBlLCBuKSB7CiAgInVzZSBzdHJpY3QiOwoKICB2YXIgciA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIFN5bWJvbCAmJiAic3ltYm9sIiA9PSBfdHlwZW9mMihTeW1ib2wuaXRlcmF0b3IpID8gZnVuY3Rpb24gKHQpIHsKICAgIHJldHVybiBfdHlwZW9mMih0KTsKICB9IDogZnVuY3Rpb24gKHQpIHsKICAgIHJldHVybiB0ICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIFN5bWJvbCAmJiB0LmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgdCAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogX3R5cGVvZjIodCk7CiAgfSwKICAgICAgbyA9ICJbQ09ERV9WRVJJRlldIiwKICAgICAgaSA9ICgicG9zdE1lc3NhZ2UiIGluIHdpbmRvdyk7CgogIGZ1bmN0aW9uIGEodCwgZSwgbikgewogICAgdmFyIG8gPSAiIjsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMiA/IG8gPSAiW01zZ2VyXSBlcnJvciAxIiA6ICJvYmplY3QiICE9ICh2b2lkIDAgPT09IHQgPyAidW5kZWZpbmVkIiA6IHIodCkpID8gbyA9ICJbTXNnZXJdIGVycm9yIDIiIDogInN0cmluZyIgIT0gdHlwZW9mIGUgJiYgKG8gPSAiW01zZ2VyXSBlcnJvciAzIiksIG8pIHRocm93IG5ldyBFcnJvcihvKTsKICAgIHRoaXMudGFyZ2V0ID0gdCwgdGhpcy5uYW1lID0gZSwgdGhpcy5kb21haW4gPSBuIHx8ICIqIjsKICB9CgogIGZ1bmN0aW9uIGModCwgZSkgewogICAgdGhpcy50YXJnZXRzID0ge30sIHRoaXMubmFtZSA9IHQsIHRoaXMubGlzdGVuRnVuYyA9IFtdLCAic3RyaW5nIiAhPSB0eXBlb2YgKG8gPSBlIHx8IG8pICYmIChvID0gby50b1N0cmluZygpKSwgdGhpcy5pbml0TGlzdGVuKCk7CiAgfQoKICBhLnByb3RvdHlwZS5zZW5kID0gaSA/IGZ1bmN0aW9uICh0KSB7CiAgICB0aGlzLnRhcmdldC5wb3N0TWVzc2FnZSh0LCB0aGlzLmRvbWFpbik7CiAgfSA6IGZ1bmN0aW9uICh0KSB7CiAgICB2YXIgZSA9IHdpbmRvdy5uYXZpZ2F0b3JbbyArIHRoaXMubmFtZV07CiAgICBpZiAoImZ1bmN0aW9uIiAhPSB0eXBlb2YgZSkgdGhyb3cgbmV3IEVycm9yKCJ0YXJnZXQgY2FsbGJhY2sgZnVuY3Rpb24gaXMgbm90IGRlZmluZWQiKTsKICAgIGUodCwgd2luZG93KTsKICB9LCBjLnByb3RvdHlwZS5hZGRUYXJnZXQgPSBmdW5jdGlvbiAodCwgZSwgbikgewogICAgdmFyIHIgPSBuZXcgYSh0LCBlLCBuKTsKICAgIHRoaXMudGFyZ2V0c1tlXSA9IHI7CiAgfSwgYy5wcm90b3R5cGUuaW5pdExpc3RlbiA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciB0ID0gdGhpcywKICAgICAgICBlID0gZnVuY3Rpb24gZShfZSkgewogICAgICAib2JqZWN0IiA9PSAodm9pZCAwID09PSBfZSA/ICJ1bmRlZmluZWQiIDogcihfZSkpICYmIF9lLmRhdGEgJiYgKF9lID0gX2UuZGF0YSk7CgogICAgICBmb3IgKHZhciBuID0gMDsgbiA8IHQubGlzdGVuRnVuYy5sZW5ndGg7IG4rKykgewogICAgICAgIHQubGlzdGVuRnVuY1tuXShfZSk7CiAgICAgIH0KICAgIH07CgogICAgaSA/ICJhZGRFdmVudExpc3RlbmVyIiBpbiBkb2N1bWVudCA/IHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJtZXNzYWdlIiwgZSwgITEpIDogImF0dGFjaEV2ZW50IiBpbiBkb2N1bWVudCAmJiB3aW5kb3cuYXR0YWNoRXZlbnQoIm9ubWVzc2FnZSIsIGUpIDogd2luZG93Lm5hdmlnYXRvcltvICsgdGhpcy5uYW1lXSA9IGU7CiAgfSwgYy5wcm90b3R5cGUubGlzdGVuID0gZnVuY3Rpb24gKHQpIHsKICAgIHRoaXMubGlzdGVuRnVuYy5wdXNoKHQpOwogIH0sIGMucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24gKCkgewogICAgdGhpcy5saXN0ZW5GdW5jID0gW107CiAgfSwgYy5wcm90b3R5cGUuc2VuZCA9IGZ1bmN0aW9uICh0KSB7CiAgICB2YXIgZSwKICAgICAgICBuID0gdGhpcy50YXJnZXRzOwoKICAgIGZvciAoZSBpbiBuKSB7CiAgICAgIG4uaGFzT3duUHJvcGVydHkoZSkgJiYgbltlXS5zZW5kKHQpOwogICAgfQogIH0sIHdpbmRvdy5UQ2FwTXNnID0gYywgdC5leHBvcnRzID0gYzsKfSwsLCwsLCwsIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAidXNlIHN0cmljdCI7CgogIHZhciBfdHlwZW9mID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgU3ltYm9sICYmICJzeW1ib2wiID09IF90eXBlb2YyKFN5bWJvbC5pdGVyYXRvcikgPyBmdW5jdGlvbiAodCkgewogICAgcmV0dXJuIF90eXBlb2YyKHQpOwogIH0gOiBmdW5jdGlvbiAodCkgewogICAgcmV0dXJuIHQgJiYgImZ1bmN0aW9uIiA9PSB0eXBlb2YgU3ltYm9sICYmIHQuY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiB0ICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiBfdHlwZW9mMih0KTsKICB9OwoKICBpZiAoITAgPT09IHdpbmRvdy5fX1RlbmNlbnRDYXB0Y2hhRXhpc3RzX18pIHRocm93IG5ldyBFcnJvcigiXHU4QkY3XHU1MkZGXHU1OTFBXHU2QjIxXHU1RjE1XHU3NTI4XHU4MTdFXHU4QkFGXHU5QThDXHU4QkMxXHU3ODAxXHU3Njg0XHU2M0E1XHU1MTY1anMiKTsKICB3aW5kb3cuX19UZW5jZW50Q2FwdGNoYUV4aXN0c19fID0gITAsIF9fd2VicGFja19yZXF1aXJlX18oMjEpLCBfX3dlYnBhY2tfcmVxdWlyZV9fKDExKTsKCiAgdmFyIE1lc3NlbmdlciA9IF9fd2VicGFja19yZXF1aXJlX18oMTIpLAogICAgICBkb21SZWFkeSA9IF9fd2VicGFja19yZXF1aXJlX18oMjMpLAogICAgICBidG9hID0gd2luZG93LmJ0b2EgfHwgX193ZWJwYWNrX3JlcXVpcmVfXygyNCksCiAgICAgIGV4dGVuZCA9IE9iamVjdC5hc3NpZ24gfHwgX193ZWJwYWNrX3JlcXVpcmVfXygyKSwKICAgICAgbG9hZFNjcmlwdCA9IF9fd2VicGFja19yZXF1aXJlX18oMjUpLAogICAgICBldmVudExpc3RlbmVyID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3KSwKICAgICAgRXhlY3V0b3IgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI2KSwKICAgICAgaXNJRVZhciA9IF9fd2VicGFja19yZXF1aXJlX18oMjcpLAogICAgICBpc0VsZW1lbnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI4KSwKICAgICAgaW52aXNpYmxlSWZyYW1lID0gX193ZWJwYWNrX3JlcXVpcmVfXygyOSksCiAgICAgIGdldFNjcmlwdERvbWFpbiA9IF9fd2VicGFja19yZXF1aXJlX18oMzApLAogICAgICBzY3JpcHREb21haW4gPSBnZXRTY3JpcHREb21haW4oKSB8fCAiIiwKICAgICAgaXNXZWNoYXREZXZ0b29scyA9IG5hdmlnYXRvci51c2VyQWdlbnQgJiYgL3dlY2hhdGRldnRvb2xzLy50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpLAogICAgICBpc1dpbmRvd3MgPSAvd2luZG93cy9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCksCiAgICAgIGlzTW9iaWxlID0gIWlzV2luZG93cyAmJiAoIm9udG91Y2hzdGFydCIgaW4gd2luZG93IHx8ICJvbnRvdWNoc3RhcnQiIGluIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpIHx8IGlzV2VjaGF0RGV2dG9vbHMpLAogICAgICBjYXBEb21haW4gPSAiaHR0cHM6Ly90LmNhcHRjaGEucXEuY29tIjsKCiAgY2FwRG9tYWluIHx8IChjYXBEb21haW4gPSBzY3JpcHREb21haW4pOwoKICB2YXIgY2RuRG9tYWluID0gImh0dHBzOi8vY2FwdGNoYS5ndGltZy5jb20vMSIsCiAgICAgIGdyYXlzY2FsZUZyYW1lSnMgPSAiL3RjYXB0Y2hhLWZyYW1lLjIxNTY1ZTgzLmpzIiwKICAgICAgbmVlZEdyYXlzY2FsZUpzID0gdm9pZCAwLAogICAgICBjYXBFcnJvciA9IF9fd2VicGFja19yZXF1aXJlX18oMyksCiAgICAgIHByZVZlcmlmeURhdGEgPSB7fSwKICAgICAgY2FwT2JqID0gdm9pZCAwLAogICAgICBpbml0UXVldWUgPSBbXSwKICAgICAgZGVmYXVsdE9wdCA9IHsKICAgIHR5cGU6ICJwb3B1cCIsCiAgICBwb3M6IGlzSUVWYXIoNikgPyAiYWJzb2x1dGUiIDogImZpeGVkIiwKICAgIGxhbmc6IDIwNTIsCiAgICBzaG93SGVhZGVyOiBpc01vYmlsZSwKICAgIG5lZWRGZWVkQmFjazogdHJ1ZSwKICAgIHRoZW1lQ29sb3I6ICIiLAogICAgdGNhcHRjaGFGbGFnOiAhMCwKICAgIGdldHR5cGU6ICJjYXBfdW5pb25fcHJlaGFuZGxlIiwKICAgIGRvbWFpbjogY2FwRG9tYWluLAogICAgaHRkb2NfcGF0aDogY2FwRG9tYWluCiAgfSwKICAgICAgbm9vcCA9IGZ1bmN0aW9uIG5vb3AoKSB7fSwKICAgICAgY2FsbGJhY2tXcmFwID0gZnVuY3Rpb24gY2FsbGJhY2tXcmFwKHQsIGUpIHsKICAgIHJldHVybiBmdW5jdGlvbiAobikgewogICAgICAib2JqZWN0IiA9PT0gKHZvaWQgMCA9PT0gbiA/ICJ1bmRlZmluZWQiIDogX3R5cGVvZihuKSkgJiYgKG4gPSBleHRlbmQoewogICAgICAgIGJpelN0YXRlOiB0Lm9wdGlvbnMuYml6U3RhdGUsCiAgICAgICAgYXBwaWQ6IHQub3B0aW9ucy5hcHBpZAogICAgICB9LCBuKSksIGUgJiYgZShuKTsKICAgIH07CiAgfSwKICAgICAgZXhlY3V0b3IgPSBuZXcgRXhlY3V0b3IoZnVuY3Rpb24gKCkgewogICAgaWYgKGluaXRRdWV1ZS5sZW5ndGggPiAwKSB7CiAgICAgIGZvciAodmFyIHQgPSAwOyB0IDwgaW5pdFF1ZXVlLmxlbmd0aDsgdCsrKSB7CiAgICAgICAgaW5pdFF1ZXVlW3RdLnNob3coKTsKICAgICAgfQoKICAgICAgaW5pdFF1ZXVlLmxlbmd0aCA9IDA7CiAgICB9CiAgfSwgMCksCiAgICAgIENhcHRjaGEgPSBmdW5jdGlvbiBDYXB0Y2hhKCRidG4sIGFwcGlkLCBfdGNhbGxiYWNrXywgb3B0cykgewogICAgdmFyIGJpelN0YXRlID0gdm9pZCAwOwogICAgaWYgKGlzRWxlbWVudCgkYnRuKSkgewogICAgICBpZiAoYXBwaWQgJiYgIm9iamVjdCIgPT09ICh2b2lkIDAgPT09IGFwcGlkID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mKGFwcGlkKSkpIG9wdHMgPSBhcHBpZCwgYXBwaWQgPSBudWxsLCBfdGNhbGxiYWNrXyA9IG51bGw7ZWxzZSB7CiAgICAgICAgaWYgKGFwcGlkID0gYXBwaWQgfHwgJGJ0bi5nZXRBdHRyaWJ1dGUoImRhdGEtYXBwaWQiKSwgIV90Y2FsbGJhY2tfKSB7CiAgICAgICAgICB2YXIgY2FsbGJhY2tOYW1lID0gJGJ0bi5nZXRBdHRyaWJ1dGUoImRhdGEtY2JmbiIpOwoKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIF90Y2FsbGJhY2tfID0gZXZhbCgid2luZG93LiIgKyBjYWxsYmFja05hbWUpOwogICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkxvc3QgYGNhbGxiYWNrYCIpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgYml6U3RhdGUgPSAkYnRuLmdldEF0dHJpYnV0ZSgiZGF0YS1iaXotc3RhdGUiKTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgaWYgKCJzdHJpbmciICE9IHR5cGVvZiAkYnRuIHx8ICJmdW5jdGlvbiIgIT0gdHlwZW9mIGFwcGlkKSB0aHJvdyBuZXcgRXJyb3IoIkFyZ3VtZW50cyBlcnJvci4iKTsKICAgICAgb3B0cyA9IF90Y2FsbGJhY2tfLCBfdGNhbGxiYWNrXyA9IGFwcGlkLCBhcHBpZCA9ICRidG4sICRidG4gPSBudWxsOwogICAgfQogICAgb3B0cyA9IG9wdHMgfHwge30sIG9wdHMuY2FsbGJhY2sgPSBfdGNhbGxiYWNrXyB8fCBvcHRzLmNhbGxiYWNrLCBvcHRzLnN0YXJ0ID0gb3B0cy5zdGFydCB8fCBub29wLCBvcHRzLmVuZCA9IG9wdHMuZW5kIHx8IG5vb3A7CiAgICB2YXIgcmVhZHlDYWxsYmFjayA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIG9wdHMucmVhZHkgPyBvcHRzLnJlYWR5IDogbm9vcDsKICAgIGlmIChvcHRzLnJlYWR5ID0gZnVuY3Rpb24gKHQpIHsKICAgICAgcmVhZHlDYWxsYmFjay5jYWxsKHRoaXMsIHQpOwogICAgfSwgb3B0cy5hcHBpZCA9IGFwcGlkIHx8IG9wdHMuYXBwaWQsIG9wdHMuYml6U3RhdGUgPSBiaXpTdGF0ZSB8fCBvcHRzLmJpelN0YXRlLCBvcHRzLmZ3aWR0aCA9IHBhcnNlRmxvYXQob3B0cy5md2lkdGgpIHx8IDAsIG9wdHMuc2RrT3B0cyA9IG9wdHMuc2RrT3B0cyB8fCBudWxsLCBvcHRzLmVsZSA9ICRidG4sIHRoaXMub3B0aW9ucyA9IG9wdHMsICJmdW5jdGlvbiIgIT0gdHlwZW9mIG9wdHMuY2FsbGJhY2spIHRocm93IG5ldyBFcnJvcigiTG9zdCBgY2FsbGJhY2tgIik7CgogICAgaWYgKHRoaXMuaW5pdE9wdHMgPSBleHRlbmQoe30sIGRlZmF1bHRPcHQsIG9wdHMpLCB0aGlzLmxhbmdGdW4oKSwgJGJ0bikgewogICAgICB2YXIgdGhhdCA9IHRoaXM7CiAgICAgIGV2ZW50TGlzdGVuZXIuYWRkKCRidG4sICJjbGljayIsIGZ1bmN0aW9uICgpIHsKICAgICAgICB0aGF0LnNob3coKTsKICAgICAgfSk7CiAgICB9CiAgfTsKCiAgQ2FwdGNoYS5wcm90b3R5cGUgPSB7CiAgICBzaG93OiBmdW5jdGlvbiBzaG93KCkgewogICAgICBpZiAoZXhlY3V0b3IuaXNEb25lKSB0aGlzLl9fc2hvd19fKCk7ZWxzZSB7CiAgICAgICAgZm9yICh2YXIgdCA9IDA7IHQgPCBpbml0UXVldWUubGVuZ3RoOyB0KyspIHsKICAgICAgICAgIGlmIChpbml0UXVldWVbdF0gPT09IHRoaXMpIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGluaXRRdWV1ZS5wdXNoKHRoaXMpOwogICAgICB9CiAgICB9LAogICAgX19zaG93X186IGZ1bmN0aW9uIF9fc2hvd19fKCkgewogICAgICB2YXIgdCA9IHRoaXMuaW5pdE9wdHM7CiAgICAgIGlmICgidW5kZWZpbmVkIiA9PSB0eXBlb2Ygd2luZG93LkFxU0NvZGUpIHJldHVybiBjYXBFcnJvci5zZW5kKCJFUlJPUl9UWVBFX0ZSQU1FSlNfQ09ERV9FUlJPUiIsIHQuYXBwaWQpLCBhbGVydCgiXHU5ODc1XHU5NzYyXHU1MkEwXHU4RjdEXHU1RjAyXHU1RTM4XHVGRjBDXHU4QkY3XHU1MjM3XHU2NUIwXHU5ODc1XHU5NzYyXHU5MUNEXHU4QkQ1Iik7CiAgICAgIHRoaXMuZGVzdHJveSgpOwogICAgICB2YXIgZSA9IFtdOwoKICAgICAgZm9yICh2YXIgbiBpbiBlLnB1c2goImFpZD0iICsgdC5hcHBpZCksIGUucHVzaCgicHJvdG9jb2w9aHR0cHMiKSwgZS5wdXNoKCJhY2N2ZXI9MSIpLCBlLnB1c2goInNob3d0eXBlPSIgKyB0LnR5cGUpLCBlLnB1c2goInVhPSIgKyBlbmNvZGVVUklDb21wb25lbnQoYnRvYSgobmF2aWdhdG9yLnVzZXJBZ2VudCB8fCAiIikucmVwbGFjZSgvW1x1MDBmZi1cdWZmZmZdKy9nLCAiIikpKSksIGUucHVzaCgibm9oZWFkZXI9IiArICgiIiArIHQuc2hvd0hlYWRlciA9PSAiZmFsc2UiID8gIjEiIDogIjAiKSksIGUucHVzaCgiZmI9IiArICgiIiArIHQubmVlZEZlZWRCYWNrID09ICJmYWxzZSIgPyAiMCIgOiAiMSIpKSwgZS5wdXNoKCJlbmFibGVEYXJrTW9kZT0iICsgKHQuZW5hYmxlRGFya01vZGUgPyAiMSIgOiAiMCIpKSwgdC5zaWQgJiYgZS5wdXNoKCJzaWQ9IiArIHQuc2lkKSwgcHJlVmVyaWZ5RGF0YSkgewogICAgICAgIHByZVZlcmlmeURhdGFbbl0gJiYgZS5wdXNoKG4gKyAiPSIgKyBlbmNvZGVVUklDb21wb25lbnQocHJlVmVyaWZ5RGF0YVtuXSkpOwogICAgICB9CgogICAgICB0LnVpZCA9ICIiICsgKHQudWluIHx8ICIiKSwgbmVlZEdyYXlzY2FsZUpzICYmIChlLnB1c2goImdyYXlzY2FsZT0xIiksIHQuZ3JheXNjYWxlID0gMSksIGlzTW9iaWxlID8gKGUucHVzaCgiY2xpZW50eXBlPTEiKSwgdC5jbGllbnR5cGUgPSAxLCB0LmZvcmNlTGFuZyAmJiBlLnB1c2goImxhbmc9IiArIHQuZm9yY2VMYW5nKSwgdC5wYXJhbXMgPSAiPyIgKyBlLmpvaW4oIiYiKSkgOiAoZS5wdXNoKCJjbGllbnR5cGU9MiIpLCB0LmNsaWVudHlwZSA9IDIsIG5lZWRHcmF5c2NhbGVKcyAmJiB0LmZvcmNlTGFuZyAmJiBlLnB1c2goImxhbmc9IiArIHQuZm9yY2VMYW5nKSwgdC5wYXJhbXMgPSAiPyIgKyBlLmpvaW4oIiYiKSwgdC5zX3R5cGVfc3VmZml4ID0gIj8iICsgZS5qb2luKCImIiksIHQuc3JjID0gY2FwRG9tYWluICsgIi90ZW1wbGF0ZS9uZXdfcGxhY2Vob2xkZXIuaHRtbCIgKyB0LnNfdHlwZV9zdWZmaXgsIHQuc190eXBlID0gY2FwRG9tYWluICsgIi9jYXBfdW5pb25fcHJlaGFuZGxlIiArIHQuc190eXBlX3N1ZmZpeCwgdC5zbGlkZV9zcmMgPSBjYXBEb21haW4gKyAiL3RlbXBsYXRlL25ld19zbGlkZV9wbGFjZWhvbGRlci5odG1sIiArIHQuc190eXBlX3N1ZmZpeCwgdC5mYiA9ICIiICsgdC5uZWVkRmVlZEJhY2sgPT0gImZhbHNlIiA/ICIwIiA6ICIxIiksIChjYXBPYmogPSBuZXcgQXFTQ29kZSh0KSkubGlzdGVuKGNhbGxiYWNrV3JhcCh0aGlzLCB0LmNhbGxiYWNrKSwgY2FsbGJhY2tXcmFwKHRoaXMsIHQucmVhZHkpKSwgY2FwT2JqLnN0YXJ0KGNhbGxiYWNrV3JhcCh0LnN0YXJ0KSksIGNhcE9iai5lbmQoY2FsbGJhY2tXcmFwKHQuZW5kKSksIG5lZWRHcmF5c2NhbGVKcyA/ICgodC50b3AgfHwgdC5sZWZ0KSAmJiBjYXBPYmouaW5pdFBvcyh7CiAgICAgICAgdG9wOiB0LnRvcCB8fCB1bmRlZmluZWQsCiAgICAgICAgbGVmdDogdC5sZWZ0IHx8IHVuZGVmaW5lZAogICAgICB9KSwgY2FwT2JqLmNyZWF0ZSgpKSA6IGlzTW9iaWxlICYmICgodC50b3AgfHwgdC5sZWZ0KSAmJiBjYXBPYmouaW5pdFBvcyh7CiAgICAgICAgdG9wOiB0LnRvcCB8fCB1bmRlZmluZWQsCiAgICAgICAgbGVmdDogdC5sZWZ0IHx8IHVuZGVmaW5lZAogICAgICB9KSwgY2FwT2JqLmNyZWF0ZSgpKTsKICAgIH0sCiAgICBsYW5nRnVuOiBmdW5jdGlvbiBsYW5nRnVuKCkgewogICAgICBpZiAodGhpcy5pbml0T3B0cy5mb3JjZUxhbmcpIHsKICAgICAgICB2YXIgdCA9IHsKICAgICAgICAgICJ6aC1jbiI6ICIyMDUyIiwKICAgICAgICAgICJ6aC1oayI6ICIxMDI4IiwKICAgICAgICAgIGVuOiAiMTAzMyIKICAgICAgICB9LAogICAgICAgICAgICBlID0gdGhpcy5pbml0T3B0cy5mb3JjZUxhbmc7CiAgICAgICAgdFtlXSA/ICh0aGlzLmluaXRPcHRzLmxhbmcgPSB0W2VdLCB0aGlzLmluaXRPcHRzLmZvcmNlTGFuZyA9IHRbZV0sIHRoaXMuaW5pdE9wdHMuZm9yY2VzdHlsZSA9IDEpIDogdGhpcy5pbml0T3B0cy5mb3JjZUxhbmcgPSAiIjsKICAgICAgfQogICAgfSwKICAgIGRlc3Ryb3k6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7CiAgICAgIGNhcE9iaiAmJiBjYXBPYmouZGVzdHJveSAmJiBjYXBPYmouZGVzdHJveSgpOwogICAgfSwKICAgIHJlZnJlc2g6IGZ1bmN0aW9uIHJlZnJlc2goKSB7CiAgICAgIGNhcE9iaiAmJiBjYXBPYmoucmVmcmVzaCAmJiBjYXBPYmoucmVmcmVzaCgpOwogICAgfSwKICAgIGdldFRpY2tldDogZnVuY3Rpb24gZ2V0VGlja2V0KCkgewogICAgICBpZiAoY2FwT2JqICYmIGNhcE9iai5nZXRUaWNrZXQpIHsKICAgICAgICB2YXIgdCA9IG51bGw7CiAgICAgICAgcmV0dXJuIGNhbGxiYWNrV3JhcCh0aGlzLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgdCA9IGU7CiAgICAgICAgfSkoY2FwT2JqLmdldFRpY2tldCgpKSwgdDsKICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgfTsKCiAgdmFyIGF1dG9CaW5kQnRuID0gZnVuY3Rpb24gYXV0b0JpbmRCdG4oKSB7CiAgICB2YXIgdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJUZW5jZW50Q2FwdGNoYSIpOwogICAgdCAmJiBuZXcgQ2FwdGNoYSh0KTsKICB9LAogICAgICBkb21SZWFkeUNiID0gZnVuY3Rpb24gZG9tUmVhZHlDYigpIHsKICAgIHRyeSB7CiAgICAgIGF1dG9CaW5kQnRuKCk7CiAgICB9IGNhdGNoICh0KSB7fQoKICAgIG5ldyBNZXNzZW5nZXIoIlRDYXB0Y2hhVmVyaWZ5RGV0ZWN0IikubGlzdGVuKGZ1bmN0aW9uICh0KSB7CiAgICAgIGlmICh0ICYmICJvYmplY3QiID09PSAodm9pZCAwID09PSB0ID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mKHQpKSkgc3dpdGNoICh0LnR5cGUpIHsKICAgICAgICBjYXNlICJwcmVWZXJpZnkiOgogICAgICAgICAgZXh0ZW5kKHByZVZlcmlmeURhdGEsIHQuZGF0YSk7CiAgICAgIH0KICAgIH0pOwoKICAgIHRyeSB7CiAgICAgIGludmlzaWJsZUlmcmFtZShjYXBEb21haW4gKyAiL3RlbXBsYXRlL2NhcHRjaGEtcHJlLXZlcmlmeS5odG1sIik7CiAgICB9IGNhdGNoICh0KSB7fQogIH07CgogIGV4ZWN1dG9yLmV4ZWMoZnVuY3Rpb24gKHQpIHsKICAgIHZhciBlID0gITE7CiAgICBkb21SZWFkeShmdW5jdGlvbiAoKSB7CiAgICAgIGUgfHwgKGUgPSAhMCwgZG9tUmVhZHlDYigpLCB0KCkpOwogICAgfSk7CiAgfSksIGV4ZWN1dG9yLmV4ZWMoZnVuY3Rpb24gKHQpIHsKICAgIG5lZWRHcmF5c2NhbGVKcyA9ICEwLCBsb2FkU2NyaXB0KGdyYXlzY2FsZUZyYW1lSnMsIGNkbkRvbWFpbiwgY2FwRG9tYWluLCBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiAhIXdpbmRvdy5BcVNDb2RlOwogICAgfSwgZnVuY3Rpb24gKCkgewogICAgICB0KCk7CiAgICB9LCBmdW5jdGlvbiAoKSB7CiAgICAgIGNhcEVycm9yLnNlbmQoIkVSUk9SX1RZUEVfRlJBTUVKU19ET1dOTE9BRF9GQUlMIiksIHQoKTsKICAgIH0pOwogIH0pLCB3aW5kb3cuVGVuY2VudENhcHRjaGEgPSBDYXB0Y2hhOwp9LCBmdW5jdGlvbiAodCwgZSwgbikgewogIHZhciByID0gbigyMik7CiAgInN0cmluZyIgPT0gdHlwZW9mIHIgJiYgKHIgPSBbW3QuaSwgciwgIiJdXSk7CiAgbigxMCkociwge30pOwogIHIubG9jYWxzICYmICh0LmV4cG9ydHMgPSByLmxvY2Fscyk7Cn0sIGZ1bmN0aW9uICh0LCBlLCBuKSB7CiAgKHQuZXhwb3J0cyA9IG4oOSkoITEpKS5wdXNoKFt0LmksICJAa2V5ZnJhbWVzIGFuaW1hdGVfZG90c3swJXtvcGFjaXR5OjF9dG97b3BhY2l0eTowfX1ALXdlYmtpdC1rZXlmcmFtZXMgYW5pbWF0ZV9kb3RzezAle29wYWNpdHk6MX10b3tvcGFjaXR5OjB9fS5kb3QwLC5kb3Qxe2FuaW1hdGlvbjphbmltYXRlX2RvdHMgLjlzIGluZmluaXRlOy1tb3otYW5pbWF0aW9uOmFuaW1hdGVfZG90cyAuOXMgaW5maW5pdGU7LXdlYmtpdC1hbmltYXRpb246YW5pbWF0ZV9kb3RzIC45cyBpbmZpbml0ZTstby1hbmltYXRpb246YW5pbWF0ZV9kb3RzIC45cyBpbmZpbml0ZX0uZG90MXthbmltYXRpb24tZGVsYXk6LjJzOy13ZWJraXQtYW5pbWF0aW9uLWRlbGF5Oi4yc30uZG90MnthbmltYXRpb246YW5pbWF0ZV9kb3RzIC45cyBpbmZpbml0ZTstbW96LWFuaW1hdGlvbjphbmltYXRlX2RvdHMgLjlzIGluZmluaXRlOy13ZWJraXQtYW5pbWF0aW9uOmFuaW1hdGVfZG90cyAuOXMgaW5maW5pdGU7LW8tYW5pbWF0aW9uOmFuaW1hdGVfZG90cyAuOXMgaW5maW5pdGU7YW5pbWF0aW9uLWRlbGF5Oi40czstd2Via2l0LWFuaW1hdGlvbi1kZWxheTouNHN9LmRvdHNfaXRlbXtkaXNwbGF5OmlubGluZS1ibG9jazttYXJnaW4tcmlnaHQ6NXB4O3dpZHRoOjEwcHg7aGVpZ2h0OjEwcHg7Ym9yZGVyLXJhZGl1czo1MCU7YmFja2dyb3VuZDojNDg4NmZmfS52ZXJpZnktaWNvbntwb3NpdGlvbjphYnNvbHV0ZTt3aWR0aDoxMDAlO21hcmdpbi10b3A6NzBweDt0ZXh0LWFsaWduOmNlbnRlcn0udC1tYXNre3dpZHRoOjEwMCU7aGVpZ2h0OjEwMCU7cG9zaXRpb246Zml4ZWQ7X3Bvc2l0aW9uOmFic29sdXRlO2xlZnQ6MDt0b3A6MDtiYWNrZ3JvdW5kOiMwMDA7b3BhY2l0eTouNTtmaWx0ZXI6cHJvZ2lkOkRYSW1hZ2VUcmFuc2Zvcm0uTWljcm9zb2Z0LkFscGhhKG9wYWNpdHk9NTApO3otaW5kZXg6MjAwMDAwMDAwMH0iLCAiIl0pOwp9LCBmdW5jdGlvbiAodCwgZSwgbikgewogIHQuZXhwb3J0cyA9IGZ1bmN0aW9uICh0KSB7CiAgICB2YXIgX2UzLAogICAgICAgIG4gPSBbXSwKICAgICAgICByID0gZG9jdW1lbnQsCiAgICAgICAgbyA9IHIuZG9jdW1lbnRFbGVtZW50LAogICAgICAgIGkgPSBvLmRvU2Nyb2xsLAogICAgICAgIGEgPSAoaSA/IC9ebG9hZGVkfF5jLyA6IC9ebG9hZGVkfGMvKS50ZXN0KHIucmVhZHlTdGF0ZSk7CgogICAgZnVuY3Rpb24gYyh0KSB7CiAgICAgIGZvciAoYSA9IDE7IHQgPSBuLnNoaWZ0KCk7KSB7CiAgICAgICAgdCgpOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHIuYWRkRXZlbnRMaXN0ZW5lciAmJiByLmFkZEV2ZW50TGlzdGVuZXIoIkRPTUNvbnRlbnRMb2FkZWQiLCBfZTMgPSBmdW5jdGlvbiBlKCkgewogICAgICByLnJlbW92ZUV2ZW50TGlzdGVuZXIoIkRPTUNvbnRlbnRMb2FkZWQiLCBfZTMsICExKSwgYygpOwogICAgfSwgITEpLCBpICYmIHIuYXR0YWNoRXZlbnQoIm9ucmVhZHlzdGF0ZWNoYW5nZSIsIF9lMyA9IGZ1bmN0aW9uIF9lMigpIHsKICAgICAgL15jLy50ZXN0KHIucmVhZHlTdGF0ZSkgJiYgKHIuZGV0YWNoRXZlbnQoIm9ucmVhZHlzdGF0ZWNoYW5nZSIsIF9lMyksIGMoKSk7CiAgICB9KSwgdCA9IGkgPyBmdW5jdGlvbiAoZSkgewogICAgICBzZWxmICE9IHRvcCA/IGEgPyBlKCkgOiBuLnB1c2goZSkgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIG8uZG9TY3JvbGwoImxlZnQiKTsKICAgICAgICB9IGNhdGNoIChuKSB7CiAgICAgICAgICByZXR1cm4gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHQoZSk7CiAgICAgICAgICB9LCA1MCk7CiAgICAgICAgfQoKICAgICAgICBlKCk7CiAgICAgIH0oKTsKICAgIH0gOiBmdW5jdGlvbiAodCkgewogICAgICBhID8gdCgpIDogbi5wdXNoKHQpOwogICAgfTsKICB9KCk7Cn0sIGZ1bmN0aW9uICh0LCBlLCBuKSB7CiAgInVzZSBzdHJpY3QiOwoKICB2YXIgciA9ICJBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OSsvIiwKICAgICAgbyA9IGZ1bmN0aW9uIG8odCkgewogICAgdmFyIGUgPSBbMCwgMiwgMV1bdC5sZW5ndGggJSAzXSwKICAgICAgICBuID0gdC5jaGFyQ29kZUF0KDApIDw8IDE2IHwgKHQubGVuZ3RoID4gMSA/IHQuY2hhckNvZGVBdCgxKSA6IDApIDw8IDggfCAodC5sZW5ndGggPiAyID8gdC5jaGFyQ29kZUF0KDIpIDogMCk7CiAgICByZXR1cm4gW3IuY2hhckF0KG4gPj4+IDE4KSwgci5jaGFyQXQobiA+Pj4gMTIgJiA2MyksIGUgPj0gMiA/ICI9IiA6IHIuY2hhckF0KG4gPj4+IDYgJiA2MyksIGUgPj0gMSA/ICI9IiA6IHIuY2hhckF0KDYzICYgbildLmpvaW4oIiIpOwogIH07CgogIHQuZXhwb3J0cyA9IGZ1bmN0aW9uICh0KSB7CiAgICByZXR1cm4gdC5yZXBsYWNlKC9bXHNcU117MSwzfS9nLCBvKTsKICB9Owp9LCBmdW5jdGlvbiAodCwgZSwgbikgewogICJ1c2Ugc3RyaWN0IjsKCiAgdmFyIHIgPSAyOwoKICB0LmV4cG9ydHMgPSBmdW5jdGlvbiBvKHQsIGUsIG4sIGksIGEsIGMsIHMpIHsKICAgIHMgPSBzIHx8IDE7CiAgICB2YXIgdSA9ICExLAogICAgICAgIHAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKTsKCiAgICBmdW5jdGlvbiBmKHQpIHsKICAgICAgdSB8fCAodCAmJiAibG9hZCIgPT09IHQudHlwZSB8fCAvXihsb2FkZWR8Y29tcGxldGUpJC8udGVzdCh0aGlzLnJlYWR5U3RhdGUpKSAmJiAoaSgpID8gKHUgPSAhMCwgYSAmJiBhKCkpIDogbCgpKTsKICAgIH0KCiAgICBwLnR5cGUgPSAidGV4dC9qYXZhc2NyaXB0IiwgcC5hc3luYyA9ICEwLCBwLnNyYyA9IChzID4gMSA/IG4gOiBlKSArIHQsICJvbmxvYWQiIGluIHAgPyBwLm9ubG9hZCA9IGYgOiBwLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGY7CgogICAgdmFyIGwgPSBmdW5jdGlvbiBsKCkgewogICAgICB1IHx8ICh1ID0gITAsIHMgPj0gciA/IGMgJiYgYygpIDogbyh0LCBlLCBuLCBpLCBhLCBjLCBzICsgMSkpOwogICAgfTsKCiAgICBwLm9uZXJyb3IgPSBsLCBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaGVhZCIpLml0ZW0oMCkuYXBwZW5kQ2hpbGQocCk7CiAgfTsKfSwgZnVuY3Rpb24gKHQsIGUsIG4pIHsKICAidXNlIHN0cmljdCI7CgogIHZhciByID0gZnVuY3Rpb24gcih0LCBlKSB7CiAgICB0aGlzLmkgPSAwLCB0aGlzLmRvbmVDYWxsYmFjayA9IHQsIHRoaXMuaXNEb25lID0gITEsIHRoaXMudGltZW91dCA9IGUgfHwgMDsKICAgIHZhciBuID0gdGhpczsKICAgIHRoaXMuaW1tZWRpYXRlRXhlYyA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICBuLmRvbmVDaGVjaygpOwogICAgfSwgMCk7CiAgfTsKCiAgci5wcm90b3R5cGUgPSB7CiAgICBkb25lQ2hlY2s6IGZ1bmN0aW9uIGRvbmVDaGVjayh0LCBlKSB7CiAgICAgIHRyeSB7CiAgICAgICAgdCAmJiB0KGUpOwogICAgICB9IGNhdGNoIChuKSB7fQoKICAgICAgaWYgKHRoaXMuaS0tLCB0aGlzLmkgPD0gMCkgdHJ5IHsKICAgICAgICB0aGlzLmlzRG9uZSA9ICEwLCB0aGlzLmRvbmVDYWxsYmFjaygpOwogICAgICB9IGNhdGNoIChuKSB7fQogICAgfSwKICAgIGV4ZWM6IGZ1bmN0aW9uIGV4ZWModCwgZSwgbikgewogICAgICBjbGVhclRpbWVvdXQodGhpcy5pbW1lZGlhdGVFeGVjKTsKICAgICAgdmFyIHIgPSAhMSwKICAgICAgICAgIG8gPSAiIiwKICAgICAgICAgIGkgPSB0aGlzOwogICAgICB0aGlzLmkrKywgdGhpcy5pID4gMCAmJiAodGhpcy5pc0RvbmUgPSAhMSk7CgogICAgICB0cnkgewogICAgICAgIChvID0gdChmdW5jdGlvbiAodCkgewogICAgICAgICAgciB8fCAociA9ICEwLCBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaS5kb25lQ2hlY2soZSwgdCk7CiAgICAgICAgICB9LCAwKSk7CiAgICAgICAgfSkpICYmIChyID0gITAsIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgaS5kb25lQ2hlY2soZSwgbyk7CiAgICAgICAgfSwgMCkpOwogICAgICB9IGNhdGNoIChhKSB7fQoKICAgICAgKG4gPSBuIHx8IHRoaXMudGltZW91dCB8fCAwKSA+IDAgJiYgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgciB8fCAociA9ICEwLCBpLmRvbmVDaGVjayhlLCAiIikpOwogICAgICB9LCBuKTsKICAgIH0KICB9LCB0LmV4cG9ydHMgPSByOwp9LCBmdW5jdGlvbiAodCwgZSwgbikgewogICJ1c2Ugc3RyaWN0IjsKCiAgdC5leHBvcnRzID0gZnVuY3Rpb24gKHQpIHsKICAgIHZhciBlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYiIpOwogICAgcmV0dXJuIGUuaW5uZXJIVE1MID0gIlx4M2MhLS1baWYgSUUgIiArIHQgKyAiXT48aT48L2k+PCFbZW5kaWZdLS1ceDNlIiwgZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaSIpICYmIDEgPT09IGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImkiKS5sZW5ndGg7CiAgfTsKfSwgZnVuY3Rpb24gKHQsIGUsIG4pIHsKICAidXNlIHN0cmljdCI7CgogIHZhciByID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgU3ltYm9sICYmICJzeW1ib2wiID09IF90eXBlb2YyKFN5bWJvbC5pdGVyYXRvcikgPyBmdW5jdGlvbiAodCkgewogICAgcmV0dXJuIF90eXBlb2YyKHQpOwogIH0gOiBmdW5jdGlvbiAodCkgewogICAgcmV0dXJuIHQgJiYgImZ1bmN0aW9uIiA9PSB0eXBlb2YgU3ltYm9sICYmIHQuY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiB0ICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiBfdHlwZW9mMih0KTsKICB9OwoKICB0LmV4cG9ydHMgPSBmdW5jdGlvbiAodCkgewogICAgdHJ5IHsKICAgICAgcmV0dXJuIHQgaW5zdGFuY2VvZiBIVE1MRWxlbWVudDsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgcmV0dXJuICJvYmplY3QiID09PSAodm9pZCAwID09PSB0ID8gInVuZGVmaW5lZCIgOiByKHQpKSAmJiAxID09PSB0Lm5vZGVUeXBlICYmICJvYmplY3QiID09PSByKHQuc3R5bGUpICYmICJvYmplY3QiID09PSByKHQub3duZXJEb2N1bWVudCk7CiAgICB9CiAgfTsKfSwgZnVuY3Rpb24gKHQsIGUsIG4pIHsKICAidXNlIHN0cmljdCI7CgogIHQuZXhwb3J0cyA9IGZ1bmN0aW9uICh0KSB7CiAgICB2YXIgZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlmcmFtZSIpOwogICAgcmV0dXJuIGUuc3JjID0gdCwgZS5zdHlsZS5jc3NUZXh0ID0gIndpZHRoOiAwcHg7IGhlaWdodDogMHB4OyBkaXNwbGF5OiBub25lOyIsIChkb2N1bWVudC5ib2R5IHx8IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJib2R5IikuaXRlbSgiMCIpKS5hcHBlbmRDaGlsZChlKSwgZTsKICB9Owp9LCBmdW5jdGlvbiAodCwgZSwgbikgewogICJ1c2Ugc3RyaWN0IjsKCiAgdmFyIHIgPSBuKDApLmhyZWYsCiAgICAgIG8gPSBmdW5jdGlvbiBvKHQpIHsKICAgIHZhciBlID0gdC5zcGxpdCgiPyIpOwogICAgaWYgKDIgIT09IGUubGVuZ3RoKSByZXR1cm4ge307CgogICAgZm9yICh2YXIgbiA9IGVbMV0gJiYgZVsxXS5zcGxpdCgiJiIpLCByID0ge30sIG8gPSAwOyBvIDwgbi5sZW5ndGg7IG8rKykgewogICAgICB2YXIgaSA9IG5bb10uc3BsaXQoIj0iKTsKICAgICAgaVsxXSAmJiAocltpWzBdXSA9IGRlY29kZVVSSUNvbXBvbmVudChpWzFdKSk7CiAgICB9CgogICAgcmV0dXJuIHI7CiAgfSwKICAgICAgaSA9IGZ1bmN0aW9uIGkoKSB7CiAgICBmb3IgKHZhciB0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInNjcmlwdCIpLCBlID0gMDsgZSA8IHQubGVuZ3RoOyBlKyspIHsKICAgICAgdmFyIG4gPSB0W2VdOwogICAgICBpZiAobi5zcmMubWF0Y2goL2NhcHRjaGFcLmpzL2kpKSByZXR1cm4gbjsKICAgIH0KICB9OwoKICB0LmV4cG9ydHMgPSBmdW5jdGlvbiAoKSB7CiAgICB0cnkgewogICAgICB2YXIgdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJDYXB0Y2hhU2NyaXB0IikgfHwgaSgpIHx8ICIiOwogICAgICBpZiAoIXQpIHJldHVybiAiIjsKICAgICAgdmFyIGUgPSB0LnNyYywKICAgICAgICAgIG4gPSBvKGUpLmRvbWFpbjsKICAgICAgaWYgKG4pIHJldHVybiBuOwogICAgICB2YXIgYSA9IC8oaHR0cHM/XDpcL1wvWzAtOWEtekEtWi06XC5dKylcLy9pLAogICAgICAgICAgYyA9IGUubWF0Y2goYSkgfHwgcigpLm1hdGNoKGEpOwogICAgICByZXR1cm4gYyA/IGNbMV0gOiAiIjsKICAgIH0gY2F0Y2ggKHMpIHsKICAgICAgcmV0dXJuICIiOwogICAgfQogIH07Cn1dKTs="},null]}