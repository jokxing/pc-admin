{"remainingRequest":"P:\\bm_admin\\node_modules\\thread-loader\\dist\\cjs.js!P:\\bm_admin\\node_modules\\babel-loader\\lib\\index.js!P:\\bm_admin\\src\\assets\\js\\TCaptcha.js","dependencies":[{"path":"P:\\bm_admin\\src\\assets\\js\\TCaptcha.js","mtime":1594180618000},{"path":"P:\\bm_admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"P:\\bm_admin\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"P:\\bm_admin\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:cmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN5bWJvbCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN5bWJvbC5kZXNjcmlwdGlvbiIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN5bWJvbC5pdGVyYXRvciIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN5bWJvbC50by1zdHJpbmctdGFnIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0Iik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5kZXgtb2YiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5qb2luIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkubWFwIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc2xpY2UiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5mdW5jdGlvbi5uYW1lIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuanNvbi50by1zdHJpbmctdGFnIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMubWF0aC50by1zdHJpbmctdGFnIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMubnVtYmVyLmNvbnN0cnVjdG9yIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmdldC1vd24tcHJvcGVydHktZGVzY3JpcHRvciIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmciKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC50by1zdHJpbmciKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuaXRlcmF0b3IiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcubWF0Y2giKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcucmVwbGFjZSIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zZWFyY2giKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc3BsaXQiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLml0ZXJhdG9yIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvd2ViLnVybCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL3dlYi51cmwudG8tanNvbiIpOwoKdmFyIF90eXBlb2YyID0gcmVxdWlyZSgiUDovYm1fYWRtaW4vbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvdHlwZW9mIik7CgohZnVuY3Rpb24gKHQpIHsKICB2YXIgZSA9IHt9OwoKICBmdW5jdGlvbiBuKHIpIHsKICAgIGlmIChlW3JdKSByZXR1cm4gZVtyXS5leHBvcnRzOwogICAgdmFyIG8gPSBlW3JdID0gewogICAgICBpOiByLAogICAgICBsOiAhMSwKICAgICAgZXhwb3J0czoge30KICAgIH07CiAgICByZXR1cm4gdFtyXS5jYWxsKG8uZXhwb3J0cywgbywgby5leHBvcnRzLCBuKSwgby5sID0gITAsIG8uZXhwb3J0czsKICB9CgogIG4ubSA9IHQsIG4uYyA9IGUsIG4uZCA9IGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICBuLm8odCwgZSkgfHwgT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsIGUsIHsKICAgICAgZW51bWVyYWJsZTogITAsCiAgICAgIGdldDogcgogICAgfSk7CiAgfSwgbi5yID0gZnVuY3Rpb24gKHQpIHsKICAgICJ1bmRlZmluZWQiICE9IHR5cGVvZiBTeW1ib2wgJiYgU3ltYm9sLnRvU3RyaW5nVGFnICYmIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LCBTeW1ib2wudG9TdHJpbmdUYWcsIHsKICAgICAgdmFsdWU6ICJNb2R1bGUiCiAgICB9KSwgT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsICJfX2VzTW9kdWxlIiwgewogICAgICB2YWx1ZTogITAKICAgIH0pOwogIH0sIG4udCA9IGZ1bmN0aW9uICh0LCBlKSB7CiAgICBpZiAoMSAmIGUgJiYgKHQgPSBuKHQpKSwgOCAmIGUpIHJldHVybiB0OwogICAgaWYgKDQgJiBlICYmICJvYmplY3QiID09IF90eXBlb2YyKHQpICYmIHQgJiYgdC5fX2VzTW9kdWxlKSByZXR1cm4gdDsKICAgIHZhciByID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIGlmIChuLnIociksIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShyLCAiZGVmYXVsdCIsIHsKICAgICAgZW51bWVyYWJsZTogITAsCiAgICAgIHZhbHVlOiB0CiAgICB9KSwgMiAmIGUgJiYgInN0cmluZyIgIT0gdHlwZW9mIHQpIGZvciAodmFyIG8gaW4gdCkgewogICAgICBuLmQociwgbywgZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gdFtlXTsKICAgICAgfS5iaW5kKG51bGwsIG8pKTsKICAgIH0KICAgIHJldHVybiByOwogIH0sIG4ubiA9IGZ1bmN0aW9uICh0KSB7CiAgICB2YXIgZSA9IHQgJiYgdC5fX2VzTW9kdWxlID8gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gdFsiZGVmYXVsdCJdOwogICAgfSA6IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHQ7CiAgICB9OwogICAgcmV0dXJuIG4uZChlLCAiYSIsIGUpLCBlOwogIH0sIG4ubyA9IGZ1bmN0aW9uICh0LCBlKSB7CiAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHQsIGUpOwogIH0sIG4ucCA9ICIiLCBuKG4ucyA9IDIwKTsKfShbZnVuY3Rpb24gKHQsIGUsIG4pIHsKICAidXNlIHN0cmljdCI7CgogIGZ1bmN0aW9uIHIoKSB7CiAgICByZXR1cm4gTWF0aC5mbG9vcigxZTggKiBNYXRoLnJhbmRvbSgpKTsKICB9CgogIHZhciBvID0gZnVuY3Rpb24gbyh0KSB7CiAgICB0ID0gdCA/IDEgOiAwOwoKICAgIHRyeSB7CiAgICAgIHJldHVybiBzKGxvY2F0aW9uLnNlYXJjaC5zdWJzdHIodCkpOwogICAgfSBjYXRjaCAocikgewogICAgICB0cnkgewogICAgICAgIHZhciBlID0gZG9jdW1lbnQuVVJMLAogICAgICAgICAgICBuID0gZS5pbmRleE9mKCI/Iik7CiAgICAgICAgaWYgKG4gPj0gMCkgcmV0dXJuIHMoZS5zdWJzdHIobiArIHQpKTsKICAgICAgfSBjYXRjaCAocikge30KICAgIH0KCiAgICByZXR1cm4gIiI7CiAgfSwKICAgICAgaSA9IHt9OwoKICAhZnVuY3Rpb24gKCkgewogICAgZm9yICh2YXIgdCA9IG8oITApLnNwbGl0KCImIiksIGUgPSAwOyBlIDwgdC5sZW5ndGg7IGUrKykgewogICAgICB2YXIgbiA9IC8oLio/KT0oLiopLy5leGVjKHRbZV0pOwogICAgICBuICYmIChpW25bMV1dID0gblsyXSk7CiAgICB9CiAgfSgpOwogIHZhciBhID0gaS5zZXNzOwoKICBmdW5jdGlvbiBjKHQpIHsKICAgIGkuc2VzcyA9IHQ7CiAgfQoKICBmdW5jdGlvbiBzKHQpIHsKICAgIHRyeSB7CiAgICAgIHJldHVybiBpID8gdC5yZXBsYWNlKGEsIGkuc2VzcykgOiB0OwogICAgfSBjYXRjaCAoZSkgewogICAgICByZXR1cm4gdDsKICAgIH0KICB9CgogIHdpbmRvdy5jYXB0Y2hhQ29uZmlnICYmIHdpbmRvdy5jYXB0Y2hhQ29uZmlnLnNlc3MgJiYgYyh3aW5kb3cuY2FwdGNoYUNvbmZpZy5zZXNzKTsKICB0LmV4cG9ydHMgPSB7CiAgICBocmVmOiBmdW5jdGlvbiBocmVmKCkgewogICAgICB0cnkgewogICAgICAgIHJldHVybiBsb2NhdGlvbi5ocmVmOwogICAgICB9IGNhdGNoICh0KSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHJldHVybiBkb2N1bWVudC5VUkw7CiAgICAgICAgfSBjYXRjaCAodCkge30KICAgICAgfQoKICAgICAgcmV0dXJuICIiOwogICAgfSwKICAgIGdldFF1ZXJ5OiBmdW5jdGlvbiBnZXRRdWVyeSh0KSB7CiAgICAgIHZhciBlID0gbygpOwogICAgICByZXR1cm4gZSA9IGUgPyBlLnJlcGxhY2UoLyZyYW5kPVteJl0rLywgIiIpICsgIiZyYW5kPSIgKyByKCkgOiAiP3JhbmQ9IiArIHIoKSwgdCA9IHQgPyAxIDogMCwgZS5zdWJzdHIodCk7CiAgICB9LAogICAgcXVlcnlQYXJhbTogZnVuY3Rpb24gcXVlcnlQYXJhbSh0KSB7CiAgICAgIHJldHVybiBpW3RdOwogICAgfSwKICAgIHF1ZXJ5TWFwOiBmdW5jdGlvbiBxdWVyeU1hcCgpIHsKICAgICAgcmV0dXJuICQuZXh0ZW5kKHt9LCBpKTsKICAgIH0sCiAgICBwYXJzZTJyZ2I6IGZ1bmN0aW9uIHBhcnNlMnJnYih0KSB7CiAgICAgIGlmICghdCB8fCAic3RyaW5nIiAhPSB0eXBlb2YgdCkgcmV0dXJuIG51bGw7CiAgICAgIHQgPSB0LnJlcGxhY2UoL14jPyhbYS1mXGRdKShbYS1mXGRdKShbYS1mXGRdKSQvaSwgZnVuY3Rpb24gKHQsIGUsIG4sIHIpIHsKICAgICAgICByZXR1cm4gZSArIGUgKyBuICsgbiArIHIgKyByOwogICAgICB9KTsKICAgICAgdmFyIGUgPSAvXiM/KFthLWZcZF17Mn0pKFthLWZcZF17Mn0pKFthLWZcZF17Mn0pJC9pLmV4ZWModCk7CiAgICAgIHJldHVybiBlID8gewogICAgICAgIHI6IHBhcnNlSW50KGVbMV0sIDE2KSwKICAgICAgICBnOiBwYXJzZUludChlWzJdLCAxNiksCiAgICAgICAgYjogcGFyc2VJbnQoZVszXSwgMTYpLAogICAgICAgIHM6ICIjIiArIGVbMV0gKyBlWzJdICsgZVszXQogICAgICB9IDogbnVsbDsKICAgIH0sCiAgICBhcnJJbmRleE9mOiBmdW5jdGlvbiBhcnJJbmRleE9mKHQsIGUpIHsKICAgICAgaWYgKCJmdW5jdGlvbiIgPT0gdHlwZW9mIHQuaW5kZXhPZikgcmV0dXJuIHQuaW5kZXhPZihlKTsKCiAgICAgIGZvciAodmFyIG4gPSAwOyBuIDwgdC5sZW5ndGg7IG4rKykgewogICAgICAgIGlmICh0W25dID09PSBlKSByZXR1cm4gbjsKICAgICAgfQoKICAgICAgcmV0dXJuIC0xOwogICAgfSwKICAgIHVwZGF0ZVNlc3Npb246IGMKICB9Owp9LCBmdW5jdGlvbiAodCwgZSwgbikgewogICJ1c2Ugc3RyaWN0IjsKCiAgdmFyIHIgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgdCA9IDEsCiAgICAgICAgZSA9IC9zdWJzaWQ9KFxkKykvLmV4ZWMobG9jYXRpb24uaHJlZik7CiAgICBlICYmICh0ID0gcGFyc2VJbnQoZVsxXSwgMTApICsgMSk7CgogICAgdmFyIG4gPSBmdW5jdGlvbiBuKGUsIF9uKSB7CiAgICAgIHZhciByID0gX24gfHwgdDsKICAgICAgcmV0dXJuIGUgPSAvc3Vic2lkPVxkKy8udGVzdChlKSA/IGUucmVwbGFjZSgvc3Vic2lkPVxkKy9nLCAic3Vic2lkPSIgKyByKSA6IGUgKyAiJnN1YnNpZD0iICsgciwgX24gfHwgdCsrLCBlOwogICAgfTsKCiAgICByZXR1cm4gbi5nZXQgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB0OwogICAgfSwgbi5iaW5kID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgZSA9IHQrKzsKICAgICAgcmV0dXJuIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIG4odCwgZSk7CiAgICAgIH07CiAgICB9LCBuOwogIH0oKTsKCiAgdC5leHBvcnRzID0gcjsKfSwgZnVuY3Rpb24gKHQsIGUsIG4pIHsKICAidXNlIHN0cmljdCI7CgogIHZhciByID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSwKICAgICAgbyA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcsCiAgICAgIGkgPSBPYmplY3QuZGVmaW5lUHJvcGVydHksCiAgICAgIGEgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yLAogICAgICBjID0gZnVuY3Rpb24gYyh0KSB7CiAgICByZXR1cm4gImZ1bmN0aW9uIiA9PSB0eXBlb2YgQXJyYXkuaXNBcnJheSA/IEFycmF5LmlzQXJyYXkodCkgOiAiW29iamVjdCBBcnJheV0iID09PSBvLmNhbGwodCk7CiAgfSwKICAgICAgcyA9IGZ1bmN0aW9uIHModCkgewogICAgaWYgKCF0IHx8ICJbb2JqZWN0IE9iamVjdF0iICE9PSBvLmNhbGwodCkpIHJldHVybiAhMTsKICAgIHZhciBlLAogICAgICAgIG4gPSByLmNhbGwodCwgImNvbnN0cnVjdG9yIiksCiAgICAgICAgaSA9IHQuY29uc3RydWN0b3IgJiYgdC5jb25zdHJ1Y3Rvci5wcm90b3R5cGUgJiYgci5jYWxsKHQuY29uc3RydWN0b3IucHJvdG90eXBlLCAiaXNQcm90b3R5cGVPZiIpOwogICAgaWYgKHQuY29uc3RydWN0b3IgJiYgIW4gJiYgIWkpIHJldHVybiAhMTsKCiAgICBmb3IgKGUgaW4gdCkgewogICAgICA7CiAgICB9CgogICAgcmV0dXJuIHZvaWQgMCA9PT0gZSB8fCByLmNhbGwodCwgZSk7CiAgfSwKICAgICAgdSA9IGZ1bmN0aW9uIHUodCwgZSkgewogICAgaSAmJiAiX19wcm90b19fIiA9PT0gZS5uYW1lID8gaSh0LCBlLm5hbWUsIHsKICAgICAgZW51bWVyYWJsZTogITAsCiAgICAgIGNvbmZpZ3VyYWJsZTogITAsCiAgICAgIHZhbHVlOiBlLm5ld1ZhbHVlLAogICAgICB3cml0YWJsZTogITAKICAgIH0pIDogdFtlLm5hbWVdID0gZS5uZXdWYWx1ZTsKICB9LAogICAgICBwID0gZnVuY3Rpb24gcCh0LCBlKSB7CiAgICBpZiAoIl9fcHJvdG9fXyIgPT09IGUpIHsKICAgICAgaWYgKCFyLmNhbGwodCwgZSkpIHJldHVybjsKICAgICAgaWYgKGEpIHJldHVybiBhKHQsIGUpLnZhbHVlOwogICAgfQoKICAgIHJldHVybiB0W2VdOwogIH07CgogIHQuZXhwb3J0cyA9IGZ1bmN0aW9uIGYoKSB7CiAgICB2YXIgdCwKICAgICAgICBlLAogICAgICAgIG4sCiAgICAgICAgciwKICAgICAgICBvLAogICAgICAgIGksCiAgICAgICAgYSA9IGFyZ3VtZW50c1swXSwKICAgICAgICBsID0gMSwKICAgICAgICBkID0gYXJndW1lbnRzLmxlbmd0aCwKICAgICAgICBoID0gITE7CgogICAgZm9yICgiYm9vbGVhbiIgPT0gdHlwZW9mIGEgJiYgKGggPSBhLCBhID0gYXJndW1lbnRzWzFdIHx8IHt9LCBsID0gMiksIChudWxsID09IGEgfHwgIm9iamVjdCIgIT0gX3R5cGVvZjIoYSkgJiYgImZ1bmN0aW9uIiAhPSB0eXBlb2YgYSkgJiYgKGEgPSB7fSk7IGwgPCBkOyArK2wpIHsKICAgICAgaWYgKG51bGwgIT0gKHQgPSBhcmd1bWVudHNbbF0pKSBmb3IgKGUgaW4gdCkgewogICAgICAgIG4gPSBwKGEsIGUpLCBhICE9PSAociA9IHAodCwgZSkpICYmIChoICYmIHIgJiYgKHMocikgfHwgKG8gPSBjKHIpKSkgPyAobyA/IChvID0gITEsIGkgPSBuICYmIGMobikgPyBuIDogW10pIDogaSA9IG4gJiYgcyhuKSA/IG4gOiB7fSwgdShhLCB7CiAgICAgICAgICBuYW1lOiBlLAogICAgICAgICAgbmV3VmFsdWU6IGYoaCwgaSwgcikKICAgICAgICB9KSkgOiB2b2lkIDAgIT09IHIgJiYgdShhLCB7CiAgICAgICAgICBuYW1lOiBlLAogICAgICAgICAgbmV3VmFsdWU6IHIKICAgICAgICB9KSk7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gYTsKICB9Owp9LCBmdW5jdGlvbiAodCwgZSwgbikgewogICJ1c2Ugc3RyaWN0IjsKCiAgdmFyIHIsCiAgICAgIG8sCiAgICAgIGkgPSBuKDEpLAogICAgICBhID0gewogICAgRVJST1JfVFlQRV9GUkFNRUpTX0RPV05MT0FEX0ZBSUw6IDE2LAogICAgRVJST1JfVFlQRV9KU09OUF9QUkVIQU5ETEU6IDE3LAogICAgRVJST1JfVFlQRV9GUkFNRUpTX0NPREVfRVJST1I6IDE4LAogICAgQ0FMTEJBQ0tfTkFNRTogMTkKICB9LAogICAgICBjID0gewogICAgRVJST1JfVFlQRV9GUkFNRUpTX0RPV05MT0FEX0ZBSUw6ICJFUlJPUl9UWVBFX0ZSQU1FSlNfRE9XTkxPQURfRkFJTCIsCiAgICBFUlJPUl9UWVBFX0pTT05QX1BSRUhBTkRMRTogIkVSUk9SX1RZUEVfSlNPTlBfUFJFSEFORExFIiwKICAgIEVSUk9SX1RZUEVfRlJBTUVKU19DT0RFX0VSUk9SOiAiRVJST1JfVFlQRV9GUkFNRUpTX0NPREVfRVJST1IiLAogICAgQ0FMTEJBQ0tfTkFNRTogIkNBTExCQUNLX05BTUUiCiAgfSwKICAgICAgcyA9IChyID0gZG9jdW1lbnQucmVmZXJyZXIsIG8gPSBsb2NhdGlvbi5ocmVmIHx8IGRvY3VtZW50LlVSTCwgciA9IHIubGVuZ3RoID4gNTEyID8gci5zdWJzdHIoMCwgNTEyKSA6IHIsIG8gPSBvLmxlbmd0aCA+IDEwMjQgPyBvLnN1YnN0cigwLCAxMDI0KSA6IG8sIFsicmVmZXJlcj0iICsgZW5jb2RlVVJJQ29tcG9uZW50KHIpLCAiaHJlZj0iICsgZW5jb2RlVVJJQ29tcG9uZW50KG8pXS5qb2luKCImIikpOwogIHQuZXhwb3J0cyA9IHsKICAgIHR5cGU6IGEsCiAgICBzZW5kOiBmdW5jdGlvbiBzZW5kKHQsIGUsIG4pIHsKICAgICAgdHJ5IHsKICAgICAgICAobiA9IG4gfHwgY1t0XSkubGVuZ3RoID4gMTAyNCAmJiBuLnN1YnN0cigwLCAxMDI0KTsKICAgICAgICB2YXIgciA9IFsidHlwZT0iICsgKHQgPSBhW3RdKSwgImFwcGlkPSIgKyBlLCAicmVhc29uPSIgKyBlbmNvZGVVUklDb21wb25lbnQobildLAogICAgICAgICAgICBvID0gImh0dHBzOi8vYXEucXEuY29tL2NuMi9tYW5hZ2UvbWJ0b2tlbi9jYXBfbW9uaXRvcj8iICsgcyArICImIiArIHIuam9pbigiJiIpOwogICAgICAgIG5ldyBJbWFnZSgpLnNyYyA9IGkobyk7CiAgICAgIH0gY2F0Y2ggKHUpIHt9CiAgICB9LAogICAgcGVyZmVjdFN0YWNrOiBmdW5jdGlvbiBwZXJmZWN0U3RhY2sodCkgewogICAgICB2YXIgZSA9ICIiOwogICAgICB0ICYmIHQuc3RhY2sgJiYgKGUgPSB0LnN0YWNrLnJlcGxhY2UoL1xuL2dpLCAiIikuc3BsaXQoL1xiYXRcYi8pLmpvaW4oIlxuIikucmVwbGFjZSgvXD9bXjpdKy9naSwgIiIpKTsKCiAgICAgIHRyeSB7CiAgICAgICAgdmFyIG4gPSB0LnRvU3RyaW5nKCk7CiAgICAgICAgZS5pbmRleE9mKG4pIDwgMCAmJiAoZSA9IG4gKyAiQCIgKyBlKTsKICAgICAgfSBjYXRjaCAocikge30KCiAgICAgIHJldHVybiBlOwogICAgfQogIH07Cn0sLCwsIGZ1bmN0aW9uICh0LCBlLCBuKSB7CiAgInVzZSBzdHJpY3QiOwoKICB0LmV4cG9ydHMgPSB7CiAgICBhZGQ6IGZ1bmN0aW9uIGFkZCh0LCBlLCBuKSB7CiAgICAgIHQgJiYgKHQuYWRkRXZlbnRMaXN0ZW5lciA/IHQuYWRkRXZlbnRMaXN0ZW5lcihlLCBuLCAhMSkgOiB0LmF0dGFjaEV2ZW50ID8gdC5hdHRhY2hFdmVudCgib24iICsgZSwgbikgOiB0WyJvbiIgKyBlXSA9IG4pOwogICAgfSwKICAgIHJlbW92ZTogZnVuY3Rpb24gcmVtb3ZlKHQsIGUsIG4pIHsKICAgICAgdCAmJiAodC5yZW1vdmVFdmVudExpc3RlbmVyID8gdC5yZW1vdmVFdmVudExpc3RlbmVyKGUsIG4sICExKSA6IHQuZGV0YWNoRXZlbnQgPyB0LmRldGFjaEV2ZW50KCJvbiIgKyBlLCBuKSA6IHRbIm9uIiArIGVdID0gbnVsbCk7CiAgICB9CiAgfTsKfSwsIGZ1bmN0aW9uICh0LCBlKSB7CiAgdC5leHBvcnRzID0gZnVuY3Rpb24gKHQpIHsKICAgIHZhciBlID0gW107CiAgICByZXR1cm4gZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHRoaXMubWFwKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIG4gPSBmdW5jdGlvbiAodCwgZSkgewogICAgICAgICAgdmFyIG4gPSB0WzFdIHx8ICIiLAogICAgICAgICAgICAgIHIgPSB0WzNdOwogICAgICAgICAgaWYgKCFyKSByZXR1cm4gbjsKCiAgICAgICAgICBpZiAoZSAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiBidG9hKSB7CiAgICAgICAgICAgIHZhciBvID0gKGEgPSByLCAiLyojIHNvdXJjZU1hcHBpbmdVUkw9ZGF0YTphcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9dXRmLTg7YmFzZTY0LCIgKyBidG9hKHVuZXNjYXBlKGVuY29kZVVSSUNvbXBvbmVudChKU09OLnN0cmluZ2lmeShhKSkpKSArICIgKi8iKSwKICAgICAgICAgICAgICAgIGkgPSByLnNvdXJjZXMubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgcmV0dXJuICIvKiMgc291cmNlVVJMPSIgKyByLnNvdXJjZVJvb3QgKyB0ICsgIiAqLyI7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gW25dLmNvbmNhdChpKS5jb25jYXQoW29dKS5qb2luKCJcbiIpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBhOwogICAgICAgICAgcmV0dXJuIFtuXS5qb2luKCJcbiIpOwogICAgICAgIH0oZSwgdCk7CgogICAgICAgIHJldHVybiBlWzJdID8gIkBtZWRpYSAiICsgZVsyXSArICJ7IiArIG4gKyAifSIgOiBuOwogICAgICB9KS5qb2luKCIiKTsKICAgIH0sIGUuaSA9IGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICJzdHJpbmciID09IHR5cGVvZiB0ICYmICh0ID0gW1tudWxsLCB0LCAiIl1dKTsKCiAgICAgIGZvciAodmFyIHIgPSB7fSwgbyA9IDA7IG8gPCB0aGlzLmxlbmd0aDsgbysrKSB7CiAgICAgICAgdmFyIGkgPSB0aGlzW29dWzBdOwogICAgICAgICJudW1iZXIiID09IHR5cGVvZiBpICYmIChyW2ldID0gITApOwogICAgICB9CgogICAgICBmb3IgKG8gPSAwOyBvIDwgdC5sZW5ndGg7IG8rKykgewogICAgICAgIHZhciBhID0gdFtvXTsKICAgICAgICAibnVtYmVyIiA9PSB0eXBlb2YgYVswXSAmJiByW2FbMF1dIHx8IChuICYmICFhWzJdID8gYVsyXSA9IG4gOiBuICYmIChhWzJdID0gIigiICsgYVsyXSArICIpIGFuZCAoIiArIG4gKyAiKSIpLCBlLnB1c2goYSkpOwogICAgICB9CiAgICB9LCBlOwogIH07Cn0sIGZ1bmN0aW9uICh0LCBlKSB7CiAgdmFyIG4gPSB7fSwKICAgICAgciA9IGZ1bmN0aW9uIHIodCkgewogICAgdmFyIGU7CiAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gdm9pZCAwID09PSBlICYmIChlID0gdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpKSwgZTsKICAgIH07CiAgfSwKICAgICAgbyA9IHIoZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIC9tc2llIFs2LTldXGIvLnRlc3Qod2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKSk7CiAgfSksCiAgICAgIGkgPSByKGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiBkb2N1bWVudC5oZWFkIHx8IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJoZWFkIilbMF07CiAgfSksCiAgICAgIGEgPSBudWxsLAogICAgICBjID0gMDsKCiAgZnVuY3Rpb24gcyh0LCBlKSB7CiAgICBmb3IgKHZhciByID0gMDsgciA8IHQubGVuZ3RoOyByKyspIHsKICAgICAgdmFyIG8gPSB0W3JdLAogICAgICAgICAgaSA9IG5bby5pZF07CgogICAgICBpZiAoaSkgewogICAgICAgIGkucmVmcysrOwoKICAgICAgICBmb3IgKHZhciBhID0gMDsgYSA8IGkucGFydHMubGVuZ3RoOyBhKyspIHsKICAgICAgICAgIGkucGFydHNbYV0oby5wYXJ0c1thXSk7CiAgICAgICAgfQoKICAgICAgICBmb3IgKDsgYSA8IG8ucGFydHMubGVuZ3RoOyBhKyspIHsKICAgICAgICAgIGkucGFydHMucHVzaChsKG8ucGFydHNbYV0sIGUpKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIGMgPSBbXTsKCiAgICAgICAgZm9yIChhID0gMDsgYSA8IG8ucGFydHMubGVuZ3RoOyBhKyspIHsKICAgICAgICAgIGMucHVzaChsKG8ucGFydHNbYV0sIGUpKTsKICAgICAgICB9CgogICAgICAgIG5bby5pZF0gPSB7CiAgICAgICAgICBpZDogby5pZCwKICAgICAgICAgIHJlZnM6IDEsCiAgICAgICAgICBwYXJ0czogYwogICAgICAgIH07CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIHUodCkgewogICAgZm9yICh2YXIgZSA9IFtdLCBuID0ge30sIHIgPSAwOyByIDwgdC5sZW5ndGg7IHIrKykgewogICAgICB2YXIgbyA9IHRbcl0sCiAgICAgICAgICBpID0gb1swXSwKICAgICAgICAgIGEgPSB7CiAgICAgICAgY3NzOiBvWzFdLAogICAgICAgIG1lZGlhOiBvWzJdLAogICAgICAgIHNvdXJjZU1hcDogb1szXQogICAgICB9OwogICAgICBuW2ldID8gbltpXS5wYXJ0cy5wdXNoKGEpIDogZS5wdXNoKG5baV0gPSB7CiAgICAgICAgaWQ6IGksCiAgICAgICAgcGFydHM6IFthXQogICAgICB9KTsKICAgIH0KCiAgICByZXR1cm4gZTsKICB9CgogIGZ1bmN0aW9uIHAodCwgZSkgewogICAgdmFyIG4gPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDIpOwogICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIHIgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpOwogICAgICB0LmFwcGx5KGUsIG4uY29uY2F0KHIpKTsKICAgIH07CiAgfQoKICBmdW5jdGlvbiBmKCkgewogICAgdmFyIHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzdHlsZSIpLAogICAgICAgIGUgPSBpKCk7CiAgICByZXR1cm4gdC50eXBlID0gInRleHQvY3NzIiwgZS5hcHBlbmRDaGlsZCh0KSwgdDsKICB9CgogIGZ1bmN0aW9uIGwodCwgZSkgewogICAgdmFyIG4sIHIsIG8sIHMsIHU7CgogICAgaWYgKGUuc2luZ2xldG9uKSB7CiAgICAgIHZhciBsID0gYysrOwogICAgICBuID0gYSB8fCAoYSA9IGYoKSksIHIgPSBwKHksIG51bGwsIG4sIGwsICExKSwgbyA9IHAoeSwgbnVsbCwgbiwgbCwgITApOwogICAgfSBlbHNlIHQuc291cmNlTWFwICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIFVSTCAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiBVUkwuY3JlYXRlT2JqZWN0VVJMICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIFVSTC5yZXZva2VPYmplY3RVUkwgJiYgImZ1bmN0aW9uIiA9PSB0eXBlb2YgQmxvYiAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiBidG9hID8gKHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJsaW5rIiksIHUgPSBpKCksIHMucmVsID0gInN0eWxlc2hlZXQiLCB1LmFwcGVuZENoaWxkKHMpLCByID0gcChtLCBudWxsLCBuID0gcyksIG8gPSBmdW5jdGlvbiBvKCkgewogICAgICBuLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobiksIG4uaHJlZiAmJiBVUkwucmV2b2tlT2JqZWN0VVJMKG4uaHJlZik7CiAgICB9KSA6IChuID0gZigpLCByID0gcChiLCBudWxsLCBuKSwgbyA9IGZ1bmN0aW9uIG8oKSB7CiAgICAgIG4ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChuKTsKICAgIH0pOwoKICAgIHJldHVybiByKHQpLCBmdW5jdGlvbiAoZSkgewogICAgICBpZiAoZSkgewogICAgICAgIGlmIChlLmNzcyA9PT0gdC5jc3MgJiYgZS5tZWRpYSA9PT0gdC5tZWRpYSAmJiBlLnNvdXJjZU1hcCA9PT0gdC5zb3VyY2VNYXApIHJldHVybjsKICAgICAgICByKHQgPSBlKTsKICAgICAgfSBlbHNlIG8oKTsKICAgIH07CiAgfQoKICB0LmV4cG9ydHMgPSBmdW5jdGlvbiAodCwgZSkgewogICAgaWYgKCJ1bmRlZmluZWQiICE9IHR5cGVvZiBERUJVRyAmJiBERUJVRyAmJiAib2JqZWN0IiAhPSAodHlwZW9mIGRvY3VtZW50ID09PSAidW5kZWZpbmVkIiA/ICJ1bmRlZmluZWQiIDogX3R5cGVvZjIoZG9jdW1lbnQpKSkgdGhyb3cgbmV3IEVycm9yKCJUaGUgc3R5bGUtbG9hZGVyIGNhbm5vdCBiZSB1c2VkIGluIGEgbm9uLWJyb3dzZXIgZW52aXJvbm1lbnQiKTsKICAgICJ1bmRlZmluZWQiID09IHR5cGVvZiAoZSA9IGUgfHwge30pLnNpbmdsZXRvbiAmJiAoZS5zaW5nbGV0b24gPSBvKCkpOwogICAgdmFyIHIgPSB1KHQpOwogICAgcmV0dXJuIHMociwgZSksIGZ1bmN0aW9uICh0KSB7CiAgICAgIGZvciAodmFyIG8gPSBbXSwgaSA9IDA7IGkgPCByLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIGEgPSByW2ldOwogICAgICAgIChjID0gblthLmlkXSkucmVmcy0tLCBvLnB1c2goYyk7CiAgICAgIH0KCiAgICAgIHQgJiYgcyh1KHQpLCBlKTsKCiAgICAgIGZvciAoaSA9IDA7IGkgPCBvLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIGM7CgogICAgICAgIGlmICgwID09PSAoYyA9IG9baV0pLnJlZnMpIHsKICAgICAgICAgIGZvciAodmFyIHAgPSAwOyBwIDwgYy5wYXJ0cy5sZW5ndGg7IHArKykgewogICAgICAgICAgICBjLnBhcnRzW3BdKCk7CiAgICAgICAgICB9CgogICAgICAgICAgZGVsZXRlIG5bYy5pZF07CiAgICAgICAgfQogICAgICB9CiAgICB9OwogIH07CgogIHZhciBkLAogICAgICBoID0gKGQgPSBbXSwgZnVuY3Rpb24gKHQsIGUpIHsKICAgIHZhciBuID0gW107CiAgICBkW3RdID0gZTsKCiAgICBmb3IgKHZhciByID0gMDsgciA8IGQubGVuZ3RoOyByKyspIHsKICAgICAgZFtyXSAmJiBuLnB1c2goZFtyXSk7CiAgICB9CgogICAgcmV0dXJuIG4uam9pbigiXG4iKTsKICB9KTsKCiAgZnVuY3Rpb24geSh0LCBlLCBuLCByKSB7CiAgICB2YXIgbyA9IG4gPyAiIiA6IHIuY3NzOwogICAgaWYgKHQuc3R5bGVTaGVldCkgdC5zdHlsZVNoZWV0LmNzc1RleHQgPSBoKGUsIG8pO2Vsc2UgewogICAgICB2YXIgaSA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKG8pLAogICAgICAgICAgYSA9IHQuY2hpbGROb2RlczsKICAgICAgYVtlXSAmJiB0LnJlbW92ZUNoaWxkKGFbZV0pLCBhLmxlbmd0aCA/IHQuaW5zZXJ0QmVmb3JlKGksIGFbZV0pIDogdC5hcHBlbmRDaGlsZChpKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGIodCwgZSkgewogICAgdmFyIG4gPSBlLmNzcywKICAgICAgICByID0gZS5tZWRpYTsKICAgIGUuc291cmNlTWFwOwogICAgaWYgKHIgJiYgdC5zZXRBdHRyaWJ1dGUoIm1lZGlhIiwgciksIHQuc3R5bGVTaGVldCkgdC5zdHlsZVNoZWV0LmNzc1RleHQgPSBuO2Vsc2UgewogICAgICBmb3IgKDsgdC5maXJzdENoaWxkOykgewogICAgICAgIHQucmVtb3ZlQ2hpbGQodC5maXJzdENoaWxkKTsKICAgICAgfQoKICAgICAgdC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShuKSk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBtKHQsIGUpIHsKICAgIHZhciBuID0gZS5jc3MsCiAgICAgICAgciA9IChlLm1lZGlhLCBlLnNvdXJjZU1hcCk7CiAgICByICYmIChuICs9ICJcbi8qIyBzb3VyY2VNYXBwaW5nVVJMPWRhdGE6YXBwbGljYXRpb24vanNvbjtiYXNlNjQsIiArIGJ0b2EodW5lc2NhcGUoZW5jb2RlVVJJQ29tcG9uZW50KEpTT04uc3RyaW5naWZ5KHIpKSkpICsgIiAqLyIpOwogICAgdmFyIG8gPSBuZXcgQmxvYihbbl0sIHsKICAgICAgdHlwZTogInRleHQvY3NzIgogICAgfSksCiAgICAgICAgaSA9IHQuaHJlZjsKICAgIHQuaHJlZiA9IFVSTC5jcmVhdGVPYmplY3RVUkwobyksIGkgJiYgVVJMLnJldm9rZU9iamVjdFVSTChpKTsKICB9Cn0sIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAidXNlIHN0cmljdCI7CgogIHZhciBfdHlwZW9mID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgU3ltYm9sICYmICJzeW1ib2wiID09IF90eXBlb2YyKFN5bWJvbC5pdGVyYXRvcikgPyBmdW5jdGlvbiAodCkgewogICAgcmV0dXJuIF90eXBlb2YyKHQpOwogIH0gOiBmdW5jdGlvbiAodCkgewogICAgcmV0dXJuIHQgJiYgImZ1bmN0aW9uIiA9PSB0eXBlb2YgU3ltYm9sICYmIHQuY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiB0ICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiBfdHlwZW9mMih0KTsKICB9OwoKICAib2JqZWN0IiAhPT0gKCJ1bmRlZmluZWQiID09IHR5cGVvZiBKU09OID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mKEpTT04pKSAmJiAoSlNPTiA9IHt9KSwgZnVuY3Rpb24gKCkgewogICAgdmFyIHJ4X29uZSA9IC9eW1xdLDp7fVxzXSokLywKICAgICAgICByeF90d28gPSAvXFwoPzpbIlxcXC9iZm5ydF18dVswLTlhLWZBLUZdezR9KS9nLAogICAgICAgIHJ4X3RocmVlID0gLyJbXiJcXFxuXHJdKiJ8dHJ1ZXxmYWxzZXxudWxsfC0/XGQrKD86XC5cZCopPyg/OltlRV1bK1wtXT9cZCspPy9nLAogICAgICAgIHJ4X2ZvdXIgPSAvKD86Xnw6fCwpKD86XHMqXFspKy9nLAogICAgICAgIHJ4X2VzY2FwYWJsZSA9IC9bXFwiXHUwMDAwLVx1MDAxZlx1MDA3Zi1cdTAwOWZcdTAwYWRcdTA2MDAtXHUwNjA0XHUwNzBmXHUxN2I0XHUxN2I1XHUyMDBjLVx1MjAwZlx1MjAyOC1cdTIwMmZcdTIwNjAtXHUyMDZmXHVmZWZmXHVmZmYwLVx1ZmZmZl0vZywKICAgICAgICByeF9kYW5nZXJvdXMgPSAvW1x1MDAwMFx1MDBhZFx1MDYwMC1cdTA2MDRcdTA3MGZcdTE3YjRcdTE3YjVcdTIwMGMtXHUyMDBmXHUyMDI4LVx1MjAyZlx1MjA2MC1cdTIwNmZcdWZlZmZcdWZmZjAtXHVmZmZmXS9nLAogICAgICAgIGdhcCwKICAgICAgICBpbmRlbnQsCiAgICAgICAgbWV0YSwKICAgICAgICByZXA7CgogICAgZnVuY3Rpb24gZih0KSB7CiAgICAgIHJldHVybiB0IDwgMTAgPyAiMCIgKyB0IDogdDsKICAgIH0KCiAgICBmdW5jdGlvbiB0aGlzX3ZhbHVlKCkgewogICAgICByZXR1cm4gdGhpcy52YWx1ZU9mKCk7CiAgICB9CgogICAgZnVuY3Rpb24gcXVvdGUodCkgewogICAgICByZXR1cm4gcnhfZXNjYXBhYmxlLmxhc3RJbmRleCA9IDAsIHJ4X2VzY2FwYWJsZS50ZXN0KHQpID8gJyInICsgdC5yZXBsYWNlKHJ4X2VzY2FwYWJsZSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICB2YXIgZSA9IG1ldGFbdF07CiAgICAgICAgcmV0dXJuICJzdHJpbmciID09IHR5cGVvZiBlID8gZSA6ICJcXHUiICsgKCIwMDAwIiArIHQuY2hhckNvZGVBdCgwKS50b1N0cmluZygxNikpLnNsaWNlKC00KTsKICAgICAgfSkgKyAnIicgOiAnIicgKyB0ICsgJyInOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0cih0LCBlKSB7CiAgICAgIHZhciBuLAogICAgICAgICAgciwKICAgICAgICAgIG8sCiAgICAgICAgICBpLAogICAgICAgICAgYSwKICAgICAgICAgIGMgPSBnYXAsCiAgICAgICAgICBzID0gZVt0XTsKCiAgICAgIHN3aXRjaCAocyAmJiAib2JqZWN0IiA9PT0gKHZvaWQgMCA9PT0gcyA/ICJ1bmRlZmluZWQiIDogX3R5cGVvZihzKSkgJiYgImZ1bmN0aW9uIiA9PSB0eXBlb2Ygcy50b0pTT04gJiYgKHMgPSBzLnRvSlNPTih0KSksICJmdW5jdGlvbiIgPT0gdHlwZW9mIHJlcCAmJiAocyA9IHJlcC5jYWxsKGUsIHQsIHMpKSwgdm9pZCAwID09PSBzID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mKHMpKSB7CiAgICAgICAgY2FzZSAic3RyaW5nIjoKICAgICAgICAgIHJldHVybiBxdW90ZShzKTsKCiAgICAgICAgY2FzZSAibnVtYmVyIjoKICAgICAgICAgIHJldHVybiBpc0Zpbml0ZShzKSA/IFN0cmluZyhzKSA6ICJudWxsIjsKCiAgICAgICAgY2FzZSAiYm9vbGVhbiI6CiAgICAgICAgY2FzZSAibnVsbCI6CiAgICAgICAgICByZXR1cm4gU3RyaW5nKHMpOwoKICAgICAgICBjYXNlICJvYmplY3QiOgogICAgICAgICAgaWYgKCFzKSByZXR1cm4gIm51bGwiOwoKICAgICAgICAgIGlmIChnYXAgKz0gaW5kZW50LCBhID0gW10sICJbb2JqZWN0IEFycmF5XSIgPT09IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuYXBwbHkocykpIHsKICAgICAgICAgICAgZm9yIChpID0gcy5sZW5ndGgsIG4gPSAwOyBuIDwgaTsgbiArPSAxKSB7CiAgICAgICAgICAgICAgYVtuXSA9IHN0cihuLCBzKSB8fCAibnVsbCI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBvID0gMCA9PT0gYS5sZW5ndGggPyAiW10iIDogZ2FwID8gIltcbiIgKyBnYXAgKyBhLmpvaW4oIixcbiIgKyBnYXApICsgIlxuIiArIGMgKyAiXSIgOiAiWyIgKyBhLmpvaW4oIiwiKSArICJdIiwgZ2FwID0gYywgbzsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAocmVwICYmICJvYmplY3QiID09PSAodm9pZCAwID09PSByZXAgPyAidW5kZWZpbmVkIiA6IF90eXBlb2YocmVwKSkpIGZvciAoaSA9IHJlcC5sZW5ndGgsIG4gPSAwOyBuIDwgaTsgbiArPSAxKSB7CiAgICAgICAgICAgICJzdHJpbmciID09IHR5cGVvZiByZXBbbl0gJiYgKG8gPSBzdHIociA9IHJlcFtuXSwgcykpICYmIGEucHVzaChxdW90ZShyKSArIChnYXAgPyAiOiAiIDogIjoiKSArIG8pOwogICAgICAgICAgfSBlbHNlIGZvciAociBpbiBzKSB7CiAgICAgICAgICAgIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzLCByKSAmJiAobyA9IHN0cihyLCBzKSkgJiYgYS5wdXNoKHF1b3RlKHIpICsgKGdhcCA/ICI6ICIgOiAiOiIpICsgbyk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gbyA9IDAgPT09IGEubGVuZ3RoID8gInt9IiA6IGdhcCA/ICJ7XG4iICsgZ2FwICsgYS5qb2luKCIsXG4iICsgZ2FwKSArICJcbiIgKyBjICsgIn0iIDogInsiICsgYS5qb2luKCIsIikgKyAifSIsIGdhcCA9IGMsIG87CiAgICAgIH0KICAgIH0KCiAgICAiZnVuY3Rpb24iICE9IHR5cGVvZiBEYXRlLnByb3RvdHlwZS50b0pTT04gJiYgKERhdGUucHJvdG90eXBlLnRvSlNPTiA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIGlzRmluaXRlKHRoaXMudmFsdWVPZigpKSA/IHRoaXMuZ2V0VVRDRnVsbFllYXIoKSArICItIiArIGYodGhpcy5nZXRVVENNb250aCgpICsgMSkgKyAiLSIgKyBmKHRoaXMuZ2V0VVRDRGF0ZSgpKSArICJUIiArIGYodGhpcy5nZXRVVENIb3VycygpKSArICI6IiArIGYodGhpcy5nZXRVVENNaW51dGVzKCkpICsgIjoiICsgZih0aGlzLmdldFVUQ1NlY29uZHMoKSkgKyAiWiIgOiBudWxsOwogICAgfSwgQm9vbGVhbi5wcm90b3R5cGUudG9KU09OID0gdGhpc192YWx1ZSwgTnVtYmVyLnByb3RvdHlwZS50b0pTT04gPSB0aGlzX3ZhbHVlLCBTdHJpbmcucHJvdG90eXBlLnRvSlNPTiA9IHRoaXNfdmFsdWUpLCAiZnVuY3Rpb24iICE9IHR5cGVvZiBKU09OLnN0cmluZ2lmeSAmJiAobWV0YSA9IHsKICAgICAgIlxiIjogIlxcYiIsCiAgICAgICJcdCI6ICJcXHQiLAogICAgICAiXG4iOiAiXFxuIiwKICAgICAgIlxmIjogIlxcZiIsCiAgICAgICJcciI6ICJcXHIiLAogICAgICAnIic6ICdcXCInLAogICAgICAiXFwiOiAiXFxcXCIKICAgIH0sIEpTT04uc3RyaW5naWZ5ID0gZnVuY3Rpb24gKHQsIGUsIG4pIHsKICAgICAgdmFyIHI7CiAgICAgIGlmIChnYXAgPSAiIiwgaW5kZW50ID0gIiIsICJudW1iZXIiID09IHR5cGVvZiBuKSBmb3IgKHIgPSAwOyByIDwgbjsgciArPSAxKSB7CiAgICAgICAgaW5kZW50ICs9ICIgIjsKICAgICAgfSBlbHNlICJzdHJpbmciID09IHR5cGVvZiBuICYmIChpbmRlbnQgPSBuKTsKICAgICAgaWYgKHJlcCA9IGUsIGUgJiYgImZ1bmN0aW9uIiAhPSB0eXBlb2YgZSAmJiAoIm9iamVjdCIgIT09ICh2b2lkIDAgPT09IGUgPyAidW5kZWZpbmVkIiA6IF90eXBlb2YoZSkpIHx8ICJudW1iZXIiICE9IHR5cGVvZiBlLmxlbmd0aCkpIHRocm93IG5ldyBFcnJvcigiSlNPTi5zdHJpbmdpZnkiKTsKICAgICAgcmV0dXJuIHN0cigiIiwgewogICAgICAgICIiOiB0CiAgICAgIH0pOwogICAgfSksICJmdW5jdGlvbiIgIT0gdHlwZW9mIEpTT04ucGFyc2UgJiYgKEpTT04ucGFyc2UgPSBmdW5jdGlvbiAodGV4dCwgcmV2aXZlcikgewogICAgICB2YXIgajsKCiAgICAgIGZ1bmN0aW9uIHdhbGsodCwgZSkgewogICAgICAgIHZhciBuLAogICAgICAgICAgICByLAogICAgICAgICAgICBvID0gdFtlXTsKICAgICAgICBpZiAobyAmJiAib2JqZWN0IiA9PT0gKHZvaWQgMCA9PT0gbyA/ICJ1bmRlZmluZWQiIDogX3R5cGVvZihvKSkpIGZvciAobiBpbiBvKSB7CiAgICAgICAgICBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobywgbikgJiYgKChyID0gd2FsayhvLCBuKSkgIT09IHVuZGVmaW5lZCA/IG9bbl0gPSByIDogZGVsZXRlIG9bbl0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmV2aXZlci5jYWxsKHQsIGUsIG8pOwogICAgICB9CgogICAgICBpZiAodGV4dCA9IFN0cmluZyh0ZXh0KSwgcnhfZGFuZ2Vyb3VzLmxhc3RJbmRleCA9IDAsIHJ4X2Rhbmdlcm91cy50ZXN0KHRleHQpICYmICh0ZXh0ID0gdGV4dC5yZXBsYWNlKHJ4X2Rhbmdlcm91cywgZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gIlxcdSIgKyAoIjAwMDAiICsgdC5jaGFyQ29kZUF0KDApLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTQpOwogICAgICB9KSksIHJ4X29uZS50ZXN0KHRleHQucmVwbGFjZShyeF90d28sICJAIikucmVwbGFjZShyeF90aHJlZSwgIl0iKS5yZXBsYWNlKHJ4X2ZvdXIsICIiKSkpIHJldHVybiBqID0gZXZhbCgiKCIgKyB0ZXh0ICsgIikiKSwgImZ1bmN0aW9uIiA9PSB0eXBlb2YgcmV2aXZlciA/IHdhbGsoewogICAgICAgICIiOiBqCiAgICAgIH0sICIiKSA6IGo7CiAgICAgIHRocm93IG5ldyBTeW50YXhFcnJvcigiSlNPTi5wYXJzZSIpOwogICAgfSk7CiAgfSgpOwp9LCBmdW5jdGlvbiAodCwgZSwgbikgewogICJ1c2Ugc3RyaWN0IjsKCiAgdmFyIHIgPSAiZnVuY3Rpb24iID09IHR5cGVvZiBTeW1ib2wgJiYgInN5bWJvbCIgPT0gX3R5cGVvZjIoU3ltYm9sLml0ZXJhdG9yKSA/IGZ1bmN0aW9uICh0KSB7CiAgICByZXR1cm4gX3R5cGVvZjIodCk7CiAgfSA6IGZ1bmN0aW9uICh0KSB7CiAgICByZXR1cm4gdCAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiBTeW1ib2wgJiYgdC5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIHQgIT09IFN5bWJvbC5wcm90b3R5cGUgPyAic3ltYm9sIiA6IF90eXBlb2YyKHQpOwogIH0sCiAgICAgIG8gPSAiW0NPREVfVkVSSUZZXSIsCiAgICAgIGkgPSAoInBvc3RNZXNzYWdlIiBpbiB3aW5kb3cpOwoKICBmdW5jdGlvbiBhKHQsIGUsIG4pIHsKICAgIHZhciBvID0gIiI7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDIgPyBvID0gIltNc2dlcl0gZXJyb3IgMSIgOiAib2JqZWN0IiAhPSAodm9pZCAwID09PSB0ID8gInVuZGVmaW5lZCIgOiByKHQpKSA/IG8gPSAiW01zZ2VyXSBlcnJvciAyIiA6ICJzdHJpbmciICE9IHR5cGVvZiBlICYmIChvID0gIltNc2dlcl0gZXJyb3IgMyIpLCBvKSB0aHJvdyBuZXcgRXJyb3Iobyk7CiAgICB0aGlzLnRhcmdldCA9IHQsIHRoaXMubmFtZSA9IGUsIHRoaXMuZG9tYWluID0gbiB8fCAiKiI7CiAgfQoKICBmdW5jdGlvbiBjKHQsIGUpIHsKICAgIHRoaXMudGFyZ2V0cyA9IHt9LCB0aGlzLm5hbWUgPSB0LCB0aGlzLmxpc3RlbkZ1bmMgPSBbXSwgInN0cmluZyIgIT0gdHlwZW9mIChvID0gZSB8fCBvKSAmJiAobyA9IG8udG9TdHJpbmcoKSksIHRoaXMuaW5pdExpc3RlbigpOwogIH0KCiAgYS5wcm90b3R5cGUuc2VuZCA9IGkgPyBmdW5jdGlvbiAodCkgewogICAgdGhpcy50YXJnZXQucG9zdE1lc3NhZ2UodCwgdGhpcy5kb21haW4pOwogIH0gOiBmdW5jdGlvbiAodCkgewogICAgdmFyIGUgPSB3aW5kb3cubmF2aWdhdG9yW28gKyB0aGlzLm5hbWVdOwogICAgaWYgKCJmdW5jdGlvbiIgIT0gdHlwZW9mIGUpIHRocm93IG5ldyBFcnJvcigidGFyZ2V0IGNhbGxiYWNrIGZ1bmN0aW9uIGlzIG5vdCBkZWZpbmVkIik7CiAgICBlKHQsIHdpbmRvdyk7CiAgfSwgYy5wcm90b3R5cGUuYWRkVGFyZ2V0ID0gZnVuY3Rpb24gKHQsIGUsIG4pIHsKICAgIHZhciByID0gbmV3IGEodCwgZSwgbik7CiAgICB0aGlzLnRhcmdldHNbZV0gPSByOwogIH0sIGMucHJvdG90eXBlLmluaXRMaXN0ZW4gPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgdCA9IHRoaXMsCiAgICAgICAgZSA9IGZ1bmN0aW9uIGUoX2UpIHsKICAgICAgIm9iamVjdCIgPT0gKHZvaWQgMCA9PT0gX2UgPyAidW5kZWZpbmVkIiA6IHIoX2UpKSAmJiBfZS5kYXRhICYmIChfZSA9IF9lLmRhdGEpOwoKICAgICAgZm9yICh2YXIgbiA9IDA7IG4gPCB0Lmxpc3RlbkZ1bmMubGVuZ3RoOyBuKyspIHsKICAgICAgICB0Lmxpc3RlbkZ1bmNbbl0oX2UpOwogICAgICB9CiAgICB9OwoKICAgIGkgPyAiYWRkRXZlbnRMaXN0ZW5lciIgaW4gZG9jdW1lbnQgPyB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIsIGUsICExKSA6ICJhdHRhY2hFdmVudCIgaW4gZG9jdW1lbnQgJiYgd2luZG93LmF0dGFjaEV2ZW50KCJvbm1lc3NhZ2UiLCBlKSA6IHdpbmRvdy5uYXZpZ2F0b3JbbyArIHRoaXMubmFtZV0gPSBlOwogIH0sIGMucHJvdG90eXBlLmxpc3RlbiA9IGZ1bmN0aW9uICh0KSB7CiAgICB0aGlzLmxpc3RlbkZ1bmMucHVzaCh0KTsKICB9LCBjLnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMubGlzdGVuRnVuYyA9IFtdOwogIH0sIGMucHJvdG90eXBlLnNlbmQgPSBmdW5jdGlvbiAodCkgewogICAgdmFyIGUsCiAgICAgICAgbiA9IHRoaXMudGFyZ2V0czsKCiAgICBmb3IgKGUgaW4gbikgewogICAgICBuLmhhc093blByb3BlcnR5KGUpICYmIG5bZV0uc2VuZCh0KTsKICAgIH0KICB9LCB3aW5kb3cuVENhcE1zZyA9IGMsIHQuZXhwb3J0cyA9IGM7Cn0sLCwsLCwsLCBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgInVzZSBzdHJpY3QiOwoKICB2YXIgX3R5cGVvZiA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIFN5bWJvbCAmJiAic3ltYm9sIiA9PSBfdHlwZW9mMihTeW1ib2wuaXRlcmF0b3IpID8gZnVuY3Rpb24gKHQpIHsKICAgIHJldHVybiBfdHlwZW9mMih0KTsKICB9IDogZnVuY3Rpb24gKHQpIHsKICAgIHJldHVybiB0ICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIFN5bWJvbCAmJiB0LmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgdCAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogX3R5cGVvZjIodCk7CiAgfTsKCiAgaWYgKCEwID09PSB3aW5kb3cuX19UZW5jZW50Q2FwdGNoYUV4aXN0c19fKSB0aHJvdyBuZXcgRXJyb3IoIlx1OEJGN1x1NTJGRlx1NTkxQVx1NkIyMVx1NUYxNVx1NzUyOFx1ODE3RVx1OEJBRlx1OUE4Q1x1OEJDMVx1NzgwMVx1NzY4NFx1NjNBNVx1NTE2NWpzIik7CiAgd2luZG93Ll9fVGVuY2VudENhcHRjaGFFeGlzdHNfXyA9ICEwLCBfX3dlYnBhY2tfcmVxdWlyZV9fKDIxKSwgX193ZWJwYWNrX3JlcXVpcmVfXygxMSk7CgogIHZhciBNZXNzZW5nZXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEyKSwKICAgICAgZG9tUmVhZHkgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIzKSwKICAgICAgYnRvYSA9IHdpbmRvdy5idG9hIHx8IF9fd2VicGFja19yZXF1aXJlX18oMjQpLAogICAgICBleHRlbmQgPSBPYmplY3QuYXNzaWduIHx8IF9fd2VicGFja19yZXF1aXJlX18oMiksCiAgICAgIGxvYWRTY3JpcHQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI1KSwKICAgICAgZXZlbnRMaXN0ZW5lciA9IF9fd2VicGFja19yZXF1aXJlX18oNyksCiAgICAgIEV4ZWN1dG9yID0gX193ZWJwYWNrX3JlcXVpcmVfXygyNiksCiAgICAgIGlzSUVWYXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI3KSwKICAgICAgaXNFbGVtZW50ID0gX193ZWJwYWNrX3JlcXVpcmVfXygyOCksCiAgICAgIGludmlzaWJsZUlmcmFtZSA9IF9fd2VicGFja19yZXF1aXJlX18oMjkpLAogICAgICBnZXRTY3JpcHREb21haW4gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMwKSwKICAgICAgc2NyaXB0RG9tYWluID0gZ2V0U2NyaXB0RG9tYWluKCkgfHwgIiIsCiAgICAgIGlzV2VjaGF0RGV2dG9vbHMgPSBuYXZpZ2F0b3IudXNlckFnZW50ICYmIC93ZWNoYXRkZXZ0b29scy8udGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSwKICAgICAgaXNXaW5kb3dzID0gL3dpbmRvd3MvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpLAogICAgICBpc01vYmlsZSA9ICFpc1dpbmRvd3MgJiYgKCJvbnRvdWNoc3RhcnQiIGluIHdpbmRvdyB8fCAib250b3VjaHN0YXJ0IiBpbiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSB8fCBpc1dlY2hhdERldnRvb2xzKSwKICAgICAgY2FwRG9tYWluID0gImh0dHBzOi8vdC5jYXB0Y2hhLnFxLmNvbSI7CgogIGNhcERvbWFpbiB8fCAoY2FwRG9tYWluID0gc2NyaXB0RG9tYWluKTsKCiAgdmFyIGNkbkRvbWFpbiA9ICJodHRwczovL2NhcHRjaGEuZ3RpbWcuY29tLzEiLAogICAgICBncmF5c2NhbGVGcmFtZUpzID0gIi90Y2FwdGNoYS1mcmFtZS4yMTU2NWU4My5qcyIsCiAgICAgIG5lZWRHcmF5c2NhbGVKcyA9IHZvaWQgMCwKICAgICAgY2FwRXJyb3IgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMpLAogICAgICBwcmVWZXJpZnlEYXRhID0ge30sCiAgICAgIGNhcE9iaiA9IHZvaWQgMCwKICAgICAgaW5pdFF1ZXVlID0gW10sCiAgICAgIGRlZmF1bHRPcHQgPSB7CiAgICB0eXBlOiAicG9wdXAiLAogICAgcG9zOiBpc0lFVmFyKDYpID8gImFic29sdXRlIiA6ICJmaXhlZCIsCiAgICBsYW5nOiAyMDUyLAogICAgc2hvd0hlYWRlcjogaXNNb2JpbGUsCiAgICBuZWVkRmVlZEJhY2s6IHRydWUsCiAgICB0aGVtZUNvbG9yOiAiIiwKICAgIHRjYXB0Y2hhRmxhZzogITAsCiAgICBnZXR0eXBlOiAiY2FwX3VuaW9uX3ByZWhhbmRsZSIsCiAgICBkb21haW46IGNhcERvbWFpbiwKICAgIGh0ZG9jX3BhdGg6IGNhcERvbWFpbgogIH0sCiAgICAgIG5vb3AgPSBmdW5jdGlvbiBub29wKCkge30sCiAgICAgIGNhbGxiYWNrV3JhcCA9IGZ1bmN0aW9uIGNhbGxiYWNrV3JhcCh0LCBlKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gKG4pIHsKICAgICAgIm9iamVjdCIgPT09ICh2b2lkIDAgPT09IG4gPyAidW5kZWZpbmVkIiA6IF90eXBlb2YobikpICYmIChuID0gZXh0ZW5kKHsKICAgICAgICBiaXpTdGF0ZTogdC5vcHRpb25zLmJpelN0YXRlLAogICAgICAgIGFwcGlkOiB0Lm9wdGlvbnMuYXBwaWQKICAgICAgfSwgbikpLCBlICYmIGUobik7CiAgICB9OwogIH0sCiAgICAgIGV4ZWN1dG9yID0gbmV3IEV4ZWN1dG9yKGZ1bmN0aW9uICgpIHsKICAgIGlmIChpbml0UXVldWUubGVuZ3RoID4gMCkgewogICAgICBmb3IgKHZhciB0ID0gMDsgdCA8IGluaXRRdWV1ZS5sZW5ndGg7IHQrKykgewogICAgICAgIGluaXRRdWV1ZVt0XS5zaG93KCk7CiAgICAgIH0KCiAgICAgIGluaXRRdWV1ZS5sZW5ndGggPSAwOwogICAgfQogIH0sIDApLAogICAgICBDYXB0Y2hhID0gZnVuY3Rpb24gQ2FwdGNoYSgkYnRuLCBhcHBpZCwgX3RjYWxsYmFja18sIG9wdHMpIHsKICAgIHZhciBiaXpTdGF0ZSA9IHZvaWQgMDsKICAgIGlmIChpc0VsZW1lbnQoJGJ0bikpIHsKICAgICAgaWYgKGFwcGlkICYmICJvYmplY3QiID09PSAodm9pZCAwID09PSBhcHBpZCA/ICJ1bmRlZmluZWQiIDogX3R5cGVvZihhcHBpZCkpKSBvcHRzID0gYXBwaWQsIGFwcGlkID0gbnVsbCwgX3RjYWxsYmFja18gPSBudWxsO2Vsc2UgewogICAgICAgIGlmIChhcHBpZCA9IGFwcGlkIHx8ICRidG4uZ2V0QXR0cmlidXRlKCJkYXRhLWFwcGlkIiksICFfdGNhbGxiYWNrXykgewogICAgICAgICAgdmFyIGNhbGxiYWNrTmFtZSA9ICRidG4uZ2V0QXR0cmlidXRlKCJkYXRhLWNiZm4iKTsKCiAgICAgICAgICB0cnkgewogICAgICAgICAgICBfdGNhbGxiYWNrXyA9IGV2YWwoIndpbmRvdy4iICsgY2FsbGJhY2tOYW1lKTsKICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJMb3N0IGBjYWxsYmFja2AiKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGJpelN0YXRlID0gJGJ0bi5nZXRBdHRyaWJ1dGUoImRhdGEtYml6LXN0YXRlIik7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGlmICgic3RyaW5nIiAhPSB0eXBlb2YgJGJ0biB8fCAiZnVuY3Rpb24iICE9IHR5cGVvZiBhcHBpZCkgdGhyb3cgbmV3IEVycm9yKCJBcmd1bWVudHMgZXJyb3IuIik7CiAgICAgIG9wdHMgPSBfdGNhbGxiYWNrXywgX3RjYWxsYmFja18gPSBhcHBpZCwgYXBwaWQgPSAkYnRuLCAkYnRuID0gbnVsbDsKICAgIH0KICAgIG9wdHMgPSBvcHRzIHx8IHt9LCBvcHRzLmNhbGxiYWNrID0gX3RjYWxsYmFja18gfHwgb3B0cy5jYWxsYmFjaywgb3B0cy5zdGFydCA9IG9wdHMuc3RhcnQgfHwgbm9vcCwgb3B0cy5lbmQgPSBvcHRzLmVuZCB8fCBub29wOwogICAgdmFyIHJlYWR5Q2FsbGJhY2sgPSAiZnVuY3Rpb24iID09IHR5cGVvZiBvcHRzLnJlYWR5ID8gb3B0cy5yZWFkeSA6IG5vb3A7CiAgICBpZiAob3B0cy5yZWFkeSA9IGZ1bmN0aW9uICh0KSB7CiAgICAgIHJlYWR5Q2FsbGJhY2suY2FsbCh0aGlzLCB0KTsKICAgIH0sIG9wdHMuYXBwaWQgPSBhcHBpZCB8fCBvcHRzLmFwcGlkLCBvcHRzLmJpelN0YXRlID0gYml6U3RhdGUgfHwgb3B0cy5iaXpTdGF0ZSwgb3B0cy5md2lkdGggPSBwYXJzZUZsb2F0KG9wdHMuZndpZHRoKSB8fCAwLCBvcHRzLnNka09wdHMgPSBvcHRzLnNka09wdHMgfHwgbnVsbCwgb3B0cy5lbGUgPSAkYnRuLCB0aGlzLm9wdGlvbnMgPSBvcHRzLCAiZnVuY3Rpb24iICE9IHR5cGVvZiBvcHRzLmNhbGxiYWNrKSB0aHJvdyBuZXcgRXJyb3IoIkxvc3QgYGNhbGxiYWNrYCIpOwoKICAgIGlmICh0aGlzLmluaXRPcHRzID0gZXh0ZW5kKHt9LCBkZWZhdWx0T3B0LCBvcHRzKSwgdGhpcy5sYW5nRnVuKCksICRidG4pIHsKICAgICAgdmFyIHRoYXQgPSB0aGlzOwogICAgICBldmVudExpc3RlbmVyLmFkZCgkYnRuLCAiY2xpY2siLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhhdC5zaG93KCk7CiAgICAgIH0pOwogICAgfQogIH07CgogIENhcHRjaGEucHJvdG90eXBlID0gewogICAgc2hvdzogZnVuY3Rpb24gc2hvdygpIHsKICAgICAgaWYgKGV4ZWN1dG9yLmlzRG9uZSkgdGhpcy5fX3Nob3dfXygpO2Vsc2UgewogICAgICAgIGZvciAodmFyIHQgPSAwOyB0IDwgaW5pdFF1ZXVlLmxlbmd0aDsgdCsrKSB7CiAgICAgICAgICBpZiAoaW5pdFF1ZXVlW3RdID09PSB0aGlzKSByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpbml0UXVldWUucHVzaCh0aGlzKTsKICAgICAgfQogICAgfSwKICAgIF9fc2hvd19fOiBmdW5jdGlvbiBfX3Nob3dfXygpIHsKICAgICAgdmFyIHQgPSB0aGlzLmluaXRPcHRzOwogICAgICBpZiAoInVuZGVmaW5lZCIgPT0gdHlwZW9mIHdpbmRvdy5BcVNDb2RlKSByZXR1cm4gY2FwRXJyb3Iuc2VuZCgiRVJST1JfVFlQRV9GUkFNRUpTX0NPREVfRVJST1IiLCB0LmFwcGlkKSwgYWxlcnQoIlx1OTg3NVx1OTc2Mlx1NTJBMFx1OEY3RFx1NUYwMlx1NUUzOFx1RkYwQ1x1OEJGN1x1NTIzN1x1NjVCMFx1OTg3NVx1OTc2Mlx1OTFDRFx1OEJENSIpOwogICAgICB0aGlzLmRlc3Ryb3koKTsKICAgICAgdmFyIGUgPSBbXTsKCiAgICAgIGZvciAodmFyIG4gaW4gZS5wdXNoKCJhaWQ9IiArIHQuYXBwaWQpLCBlLnB1c2goInByb3RvY29sPWh0dHBzIiksIGUucHVzaCgiYWNjdmVyPTEiKSwgZS5wdXNoKCJzaG93dHlwZT0iICsgdC50eXBlKSwgZS5wdXNoKCJ1YT0iICsgZW5jb2RlVVJJQ29tcG9uZW50KGJ0b2EoKG5hdmlnYXRvci51c2VyQWdlbnQgfHwgIiIpLnJlcGxhY2UoL1tcdTAwZmYtXHVmZmZmXSsvZywgIiIpKSkpLCBlLnB1c2goIm5vaGVhZGVyPSIgKyAoIiIgKyB0LnNob3dIZWFkZXIgPT0gImZhbHNlIiA/ICIxIiA6ICIwIikpLCBlLnB1c2goImZiPSIgKyAoIiIgKyB0Lm5lZWRGZWVkQmFjayA9PSAiZmFsc2UiID8gIjAiIDogIjEiKSksIGUucHVzaCgiZW5hYmxlRGFya01vZGU9IiArICh0LmVuYWJsZURhcmtNb2RlID8gIjEiIDogIjAiKSksIHQuc2lkICYmIGUucHVzaCgic2lkPSIgKyB0LnNpZCksIHByZVZlcmlmeURhdGEpIHsKICAgICAgICBwcmVWZXJpZnlEYXRhW25dICYmIGUucHVzaChuICsgIj0iICsgZW5jb2RlVVJJQ29tcG9uZW50KHByZVZlcmlmeURhdGFbbl0pKTsKICAgICAgfQoKICAgICAgdC51aWQgPSAiIiArICh0LnVpbiB8fCAiIiksIG5lZWRHcmF5c2NhbGVKcyAmJiAoZS5wdXNoKCJncmF5c2NhbGU9MSIpLCB0LmdyYXlzY2FsZSA9IDEpLCBpc01vYmlsZSA/IChlLnB1c2goImNsaWVudHlwZT0xIiksIHQuY2xpZW50eXBlID0gMSwgdC5mb3JjZUxhbmcgJiYgZS5wdXNoKCJsYW5nPSIgKyB0LmZvcmNlTGFuZyksIHQucGFyYW1zID0gIj8iICsgZS5qb2luKCImIikpIDogKGUucHVzaCgiY2xpZW50eXBlPTIiKSwgdC5jbGllbnR5cGUgPSAyLCBuZWVkR3JheXNjYWxlSnMgJiYgdC5mb3JjZUxhbmcgJiYgZS5wdXNoKCJsYW5nPSIgKyB0LmZvcmNlTGFuZyksIHQucGFyYW1zID0gIj8iICsgZS5qb2luKCImIiksIHQuc190eXBlX3N1ZmZpeCA9ICI/IiArIGUuam9pbigiJiIpLCB0LnNyYyA9IGNhcERvbWFpbiArICIvdGVtcGxhdGUvbmV3X3BsYWNlaG9sZGVyLmh0bWwiICsgdC5zX3R5cGVfc3VmZml4LCB0LnNfdHlwZSA9IGNhcERvbWFpbiArICIvY2FwX3VuaW9uX3ByZWhhbmRsZSIgKyB0LnNfdHlwZV9zdWZmaXgsIHQuc2xpZGVfc3JjID0gY2FwRG9tYWluICsgIi90ZW1wbGF0ZS9uZXdfc2xpZGVfcGxhY2Vob2xkZXIuaHRtbCIgKyB0LnNfdHlwZV9zdWZmaXgsIHQuZmIgPSAiIiArIHQubmVlZEZlZWRCYWNrID09ICJmYWxzZSIgPyAiMCIgOiAiMSIpLCAoY2FwT2JqID0gbmV3IEFxU0NvZGUodCkpLmxpc3RlbihjYWxsYmFja1dyYXAodGhpcywgdC5jYWxsYmFjayksIGNhbGxiYWNrV3JhcCh0aGlzLCB0LnJlYWR5KSksIGNhcE9iai5zdGFydChjYWxsYmFja1dyYXAodC5zdGFydCkpLCBjYXBPYmouZW5kKGNhbGxiYWNrV3JhcCh0LmVuZCkpLCBuZWVkR3JheXNjYWxlSnMgPyAoKHQudG9wIHx8IHQubGVmdCkgJiYgY2FwT2JqLmluaXRQb3MoewogICAgICAgIHRvcDogdC50b3AgfHwgdW5kZWZpbmVkLAogICAgICAgIGxlZnQ6IHQubGVmdCB8fCB1bmRlZmluZWQKICAgICAgfSksIGNhcE9iai5jcmVhdGUoKSkgOiBpc01vYmlsZSAmJiAoKHQudG9wIHx8IHQubGVmdCkgJiYgY2FwT2JqLmluaXRQb3MoewogICAgICAgIHRvcDogdC50b3AgfHwgdW5kZWZpbmVkLAogICAgICAgIGxlZnQ6IHQubGVmdCB8fCB1bmRlZmluZWQKICAgICAgfSksIGNhcE9iai5jcmVhdGUoKSk7CiAgICB9LAogICAgbGFuZ0Z1bjogZnVuY3Rpb24gbGFuZ0Z1bigpIHsKICAgICAgaWYgKHRoaXMuaW5pdE9wdHMuZm9yY2VMYW5nKSB7CiAgICAgICAgdmFyIHQgPSB7CiAgICAgICAgICAiemgtY24iOiAiMjA1MiIsCiAgICAgICAgICAiemgtaGsiOiAiMTAyOCIsCiAgICAgICAgICBlbjogIjEwMzMiCiAgICAgICAgfSwKICAgICAgICAgICAgZSA9IHRoaXMuaW5pdE9wdHMuZm9yY2VMYW5nOwogICAgICAgIHRbZV0gPyAodGhpcy5pbml0T3B0cy5sYW5nID0gdFtlXSwgdGhpcy5pbml0T3B0cy5mb3JjZUxhbmcgPSB0W2VdLCB0aGlzLmluaXRPcHRzLmZvcmNlc3R5bGUgPSAxKSA6IHRoaXMuaW5pdE9wdHMuZm9yY2VMYW5nID0gIiI7CiAgICAgIH0KICAgIH0sCiAgICBkZXN0cm95OiBmdW5jdGlvbiBkZXN0cm95KCkgewogICAgICBjYXBPYmogJiYgY2FwT2JqLmRlc3Ryb3kgJiYgY2FwT2JqLmRlc3Ryb3koKTsKICAgIH0sCiAgICByZWZyZXNoOiBmdW5jdGlvbiByZWZyZXNoKCkgewogICAgICBjYXBPYmogJiYgY2FwT2JqLnJlZnJlc2ggJiYgY2FwT2JqLnJlZnJlc2goKTsKICAgIH0sCiAgICBnZXRUaWNrZXQ6IGZ1bmN0aW9uIGdldFRpY2tldCgpIHsKICAgICAgaWYgKGNhcE9iaiAmJiBjYXBPYmouZ2V0VGlja2V0KSB7CiAgICAgICAgdmFyIHQgPSBudWxsOwogICAgICAgIHJldHVybiBjYWxsYmFja1dyYXAodGhpcywgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHQgPSBlOwogICAgICAgIH0pKGNhcE9iai5nZXRUaWNrZXQoKSksIHQ7CiAgICAgIH0KCiAgICAgIHJldHVybiBudWxsOwogICAgfQogIH07CgogIHZhciBhdXRvQmluZEJ0biA9IGZ1bmN0aW9uIGF1dG9CaW5kQnRuKCkgewogICAgdmFyIHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiVGVuY2VudENhcHRjaGEiKTsKICAgIHQgJiYgbmV3IENhcHRjaGEodCk7CiAgfSwKICAgICAgZG9tUmVhZHlDYiA9IGZ1bmN0aW9uIGRvbVJlYWR5Q2IoKSB7CiAgICB0cnkgewogICAgICBhdXRvQmluZEJ0bigpOwogICAgfSBjYXRjaCAodCkge30KCiAgICBuZXcgTWVzc2VuZ2VyKCJUQ2FwdGNoYVZlcmlmeURldGVjdCIpLmxpc3RlbihmdW5jdGlvbiAodCkgewogICAgICBpZiAodCAmJiAib2JqZWN0IiA9PT0gKHZvaWQgMCA9PT0gdCA/ICJ1bmRlZmluZWQiIDogX3R5cGVvZih0KSkpIHN3aXRjaCAodC50eXBlKSB7CiAgICAgICAgY2FzZSAicHJlVmVyaWZ5IjoKICAgICAgICAgIGV4dGVuZChwcmVWZXJpZnlEYXRhLCB0LmRhdGEpOwogICAgICB9CiAgICB9KTsKCiAgICB0cnkgewogICAgICBpbnZpc2libGVJZnJhbWUoY2FwRG9tYWluICsgIi90ZW1wbGF0ZS9jYXB0Y2hhLXByZS12ZXJpZnkuaHRtbCIpOwogICAgfSBjYXRjaCAodCkge30KICB9OwoKICBleGVjdXRvci5leGVjKGZ1bmN0aW9uICh0KSB7CiAgICB2YXIgZSA9ICExOwogICAgZG9tUmVhZHkoZnVuY3Rpb24gKCkgewogICAgICBlIHx8IChlID0gITAsIGRvbVJlYWR5Q2IoKSwgdCgpKTsKICAgIH0pOwogIH0pLCBleGVjdXRvci5leGVjKGZ1bmN0aW9uICh0KSB7CiAgICBuZWVkR3JheXNjYWxlSnMgPSAhMCwgbG9hZFNjcmlwdChncmF5c2NhbGVGcmFtZUpzLCBjZG5Eb21haW4sIGNhcERvbWFpbiwgZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gISF3aW5kb3cuQXFTQ29kZTsKICAgIH0sIGZ1bmN0aW9uICgpIHsKICAgICAgdCgpOwogICAgfSwgZnVuY3Rpb24gKCkgewogICAgICBjYXBFcnJvci5zZW5kKCJFUlJPUl9UWVBFX0ZSQU1FSlNfRE9XTkxPQURfRkFJTCIpLCB0KCk7CiAgICB9KTsKICB9KSwgd2luZG93LlRlbmNlbnRDYXB0Y2hhID0gQ2FwdGNoYTsKfSwgZnVuY3Rpb24gKHQsIGUsIG4pIHsKICB2YXIgciA9IG4oMjIpOwogICJzdHJpbmciID09IHR5cGVvZiByICYmIChyID0gW1t0LmksIHIsICIiXV0pOwogIG4oMTApKHIsIHt9KTsKICByLmxvY2FscyAmJiAodC5leHBvcnRzID0gci5sb2NhbHMpOwp9LCBmdW5jdGlvbiAodCwgZSwgbikgewogICh0LmV4cG9ydHMgPSBuKDkpKCExKSkucHVzaChbdC5pLCAiQGtleWZyYW1lcyBhbmltYXRlX2RvdHN7MCV7b3BhY2l0eToxfXRve29wYWNpdHk6MH19QC13ZWJraXQta2V5ZnJhbWVzIGFuaW1hdGVfZG90c3swJXtvcGFjaXR5OjF9dG97b3BhY2l0eTowfX0uZG90MCwuZG90MXthbmltYXRpb246YW5pbWF0ZV9kb3RzIC45cyBpbmZpbml0ZTstbW96LWFuaW1hdGlvbjphbmltYXRlX2RvdHMgLjlzIGluZmluaXRlOy13ZWJraXQtYW5pbWF0aW9uOmFuaW1hdGVfZG90cyAuOXMgaW5maW5pdGU7LW8tYW5pbWF0aW9uOmFuaW1hdGVfZG90cyAuOXMgaW5maW5pdGV9LmRvdDF7YW5pbWF0aW9uLWRlbGF5Oi4yczstd2Via2l0LWFuaW1hdGlvbi1kZWxheTouMnN9LmRvdDJ7YW5pbWF0aW9uOmFuaW1hdGVfZG90cyAuOXMgaW5maW5pdGU7LW1vei1hbmltYXRpb246YW5pbWF0ZV9kb3RzIC45cyBpbmZpbml0ZTstd2Via2l0LWFuaW1hdGlvbjphbmltYXRlX2RvdHMgLjlzIGluZmluaXRlOy1vLWFuaW1hdGlvbjphbmltYXRlX2RvdHMgLjlzIGluZmluaXRlO2FuaW1hdGlvbi1kZWxheTouNHM7LXdlYmtpdC1hbmltYXRpb24tZGVsYXk6LjRzfS5kb3RzX2l0ZW17ZGlzcGxheTppbmxpbmUtYmxvY2s7bWFyZ2luLXJpZ2h0OjVweDt3aWR0aDoxMHB4O2hlaWdodDoxMHB4O2JvcmRlci1yYWRpdXM6NTAlO2JhY2tncm91bmQ6IzQ4ODZmZn0udmVyaWZ5LWljb257cG9zaXRpb246YWJzb2x1dGU7d2lkdGg6MTAwJTttYXJnaW4tdG9wOjcwcHg7dGV4dC1hbGlnbjpjZW50ZXJ9LnQtbWFza3t3aWR0aDoxMDAlO2hlaWdodDoxMDAlO3Bvc2l0aW9uOmZpeGVkO19wb3NpdGlvbjphYnNvbHV0ZTtsZWZ0OjA7dG9wOjA7YmFja2dyb3VuZDojMDAwO29wYWNpdHk6LjU7ZmlsdGVyOnByb2dpZDpEWEltYWdlVHJhbnNmb3JtLk1pY3Jvc29mdC5BbHBoYShvcGFjaXR5PTUwKTt6LWluZGV4OjIwMDAwMDAwMDB9IiwgIiJdKTsKfSwgZnVuY3Rpb24gKHQsIGUsIG4pIHsKICB0LmV4cG9ydHMgPSBmdW5jdGlvbiAodCkgewogICAgdmFyIF9lMywKICAgICAgICBuID0gW10sCiAgICAgICAgciA9IGRvY3VtZW50LAogICAgICAgIG8gPSByLmRvY3VtZW50RWxlbWVudCwKICAgICAgICBpID0gby5kb1Njcm9sbCwKICAgICAgICBhID0gKGkgPyAvXmxvYWRlZHxeYy8gOiAvXmxvYWRlZHxjLykudGVzdChyLnJlYWR5U3RhdGUpOwoKICAgIGZ1bmN0aW9uIGModCkgewogICAgICBmb3IgKGEgPSAxOyB0ID0gbi5zaGlmdCgpOykgewogICAgICAgIHQoKTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiByLmFkZEV2ZW50TGlzdGVuZXIgJiYgci5hZGRFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIiwgX2UzID0gZnVuY3Rpb24gZSgpIHsKICAgICAgci5yZW1vdmVFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIiwgX2UzLCAhMSksIGMoKTsKICAgIH0sICExKSwgaSAmJiByLmF0dGFjaEV2ZW50KCJvbnJlYWR5c3RhdGVjaGFuZ2UiLCBfZTMgPSBmdW5jdGlvbiBfZTIoKSB7CiAgICAgIC9eYy8udGVzdChyLnJlYWR5U3RhdGUpICYmIChyLmRldGFjaEV2ZW50KCJvbnJlYWR5c3RhdGVjaGFuZ2UiLCBfZTMpLCBjKCkpOwogICAgfSksIHQgPSBpID8gZnVuY3Rpb24gKGUpIHsKICAgICAgc2VsZiAhPSB0b3AgPyBhID8gZSgpIDogbi5wdXNoKGUpIDogZnVuY3Rpb24gKCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICBvLmRvU2Nyb2xsKCJsZWZ0Iik7CiAgICAgICAgfSBjYXRjaCAobikgewogICAgICAgICAgcmV0dXJuIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICB0KGUpOwogICAgICAgICAgfSwgNTApOwogICAgICAgIH0KCiAgICAgICAgZSgpOwogICAgICB9KCk7CiAgICB9IDogZnVuY3Rpb24gKHQpIHsKICAgICAgYSA/IHQoKSA6IG4ucHVzaCh0KTsKICAgIH07CiAgfSgpOwp9LCBmdW5jdGlvbiAodCwgZSwgbikgewogICJ1c2Ugc3RyaWN0IjsKCiAgdmFyIHIgPSAiQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLyIsCiAgICAgIG8gPSBmdW5jdGlvbiBvKHQpIHsKICAgIHZhciBlID0gWzAsIDIsIDFdW3QubGVuZ3RoICUgM10sCiAgICAgICAgbiA9IHQuY2hhckNvZGVBdCgwKSA8PCAxNiB8ICh0Lmxlbmd0aCA+IDEgPyB0LmNoYXJDb2RlQXQoMSkgOiAwKSA8PCA4IHwgKHQubGVuZ3RoID4gMiA/IHQuY2hhckNvZGVBdCgyKSA6IDApOwogICAgcmV0dXJuIFtyLmNoYXJBdChuID4+PiAxOCksIHIuY2hhckF0KG4gPj4+IDEyICYgNjMpLCBlID49IDIgPyAiPSIgOiByLmNoYXJBdChuID4+PiA2ICYgNjMpLCBlID49IDEgPyAiPSIgOiByLmNoYXJBdCg2MyAmIG4pXS5qb2luKCIiKTsKICB9OwoKICB0LmV4cG9ydHMgPSBmdW5jdGlvbiAodCkgewogICAgcmV0dXJuIHQucmVwbGFjZSgvW1xzXFNdezEsM30vZywgbyk7CiAgfTsKfSwgZnVuY3Rpb24gKHQsIGUsIG4pIHsKICAidXNlIHN0cmljdCI7CgogIHZhciByID0gMjsKCiAgdC5leHBvcnRzID0gZnVuY3Rpb24gbyh0LCBlLCBuLCBpLCBhLCBjLCBzKSB7CiAgICBzID0gcyB8fCAxOwogICAgdmFyIHUgPSAhMSwKICAgICAgICBwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2NyaXB0Iik7CgogICAgZnVuY3Rpb24gZih0KSB7CiAgICAgIHUgfHwgKHQgJiYgImxvYWQiID09PSB0LnR5cGUgfHwgL14obG9hZGVkfGNvbXBsZXRlKSQvLnRlc3QodGhpcy5yZWFkeVN0YXRlKSkgJiYgKGkoKSA/ICh1ID0gITAsIGEgJiYgYSgpKSA6IGwoKSk7CiAgICB9CgogICAgcC50eXBlID0gInRleHQvamF2YXNjcmlwdCIsIHAuYXN5bmMgPSAhMCwgcC5zcmMgPSAocyA+IDEgPyBuIDogZSkgKyB0LCAib25sb2FkIiBpbiBwID8gcC5vbmxvYWQgPSBmIDogcC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmOwoKICAgIHZhciBsID0gZnVuY3Rpb24gbCgpIHsKICAgICAgdSB8fCAodSA9ICEwLCBzID49IHIgPyBjICYmIGMoKSA6IG8odCwgZSwgbiwgaSwgYSwgYywgcyArIDEpKTsKICAgIH07CgogICAgcC5vbmVycm9yID0gbCwgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImhlYWQiKS5pdGVtKDApLmFwcGVuZENoaWxkKHApOwogIH07Cn0sIGZ1bmN0aW9uICh0LCBlLCBuKSB7CiAgInVzZSBzdHJpY3QiOwoKICB2YXIgciA9IGZ1bmN0aW9uIHIodCwgZSkgewogICAgdGhpcy5pID0gMCwgdGhpcy5kb25lQ2FsbGJhY2sgPSB0LCB0aGlzLmlzRG9uZSA9ICExLCB0aGlzLnRpbWVvdXQgPSBlIHx8IDA7CiAgICB2YXIgbiA9IHRoaXM7CiAgICB0aGlzLmltbWVkaWF0ZUV4ZWMgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgbi5kb25lQ2hlY2soKTsKICAgIH0sIDApOwogIH07CgogIHIucHJvdG90eXBlID0gewogICAgZG9uZUNoZWNrOiBmdW5jdGlvbiBkb25lQ2hlY2sodCwgZSkgewogICAgICB0cnkgewogICAgICAgIHQgJiYgdChlKTsKICAgICAgfSBjYXRjaCAobikge30KCiAgICAgIGlmICh0aGlzLmktLSwgdGhpcy5pIDw9IDApIHRyeSB7CiAgICAgICAgdGhpcy5pc0RvbmUgPSAhMCwgdGhpcy5kb25lQ2FsbGJhY2soKTsKICAgICAgfSBjYXRjaCAobikge30KICAgIH0sCiAgICBleGVjOiBmdW5jdGlvbiBleGVjKHQsIGUsIG4pIHsKICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuaW1tZWRpYXRlRXhlYyk7CiAgICAgIHZhciByID0gITEsCiAgICAgICAgICBvID0gIiIsCiAgICAgICAgICBpID0gdGhpczsKICAgICAgdGhpcy5pKyssIHRoaXMuaSA+IDAgJiYgKHRoaXMuaXNEb25lID0gITEpOwoKICAgICAgdHJ5IHsKICAgICAgICAobyA9IHQoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHIgfHwgKHIgPSAhMCwgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGkuZG9uZUNoZWNrKGUsIHQpOwogICAgICAgICAgfSwgMCkpOwogICAgICAgIH0pKSAmJiAociA9ICEwLCBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGkuZG9uZUNoZWNrKGUsIG8pOwogICAgICAgIH0sIDApKTsKICAgICAgfSBjYXRjaCAoYSkge30KCiAgICAgIChuID0gbiB8fCB0aGlzLnRpbWVvdXQgfHwgMCkgPiAwICYmIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgIHIgfHwgKHIgPSAhMCwgaS5kb25lQ2hlY2soZSwgIiIpKTsKICAgICAgfSwgbik7CiAgICB9CiAgfSwgdC5leHBvcnRzID0gcjsKfSwgZnVuY3Rpb24gKHQsIGUsIG4pIHsKICAidXNlIHN0cmljdCI7CgogIHQuZXhwb3J0cyA9IGZ1bmN0aW9uICh0KSB7CiAgICB2YXIgZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImIiKTsKICAgIHJldHVybiBlLmlubmVySFRNTCA9ICJceDNjIS0tW2lmIElFICIgKyB0ICsgIl0+PGk+PC9pPjwhW2VuZGlmXS0tXHgzZSIsIGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImkiKSAmJiAxID09PSBlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJpIikubGVuZ3RoOwogIH07Cn0sIGZ1bmN0aW9uICh0LCBlLCBuKSB7CiAgInVzZSBzdHJpY3QiOwoKICB2YXIgciA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIFN5bWJvbCAmJiAic3ltYm9sIiA9PSBfdHlwZW9mMihTeW1ib2wuaXRlcmF0b3IpID8gZnVuY3Rpb24gKHQpIHsKICAgIHJldHVybiBfdHlwZW9mMih0KTsKICB9IDogZnVuY3Rpb24gKHQpIHsKICAgIHJldHVybiB0ICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIFN5bWJvbCAmJiB0LmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgdCAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogX3R5cGVvZjIodCk7CiAgfTsKCiAgdC5leHBvcnRzID0gZnVuY3Rpb24gKHQpIHsKICAgIHRyeSB7CiAgICAgIHJldHVybiB0IGluc3RhbmNlb2YgSFRNTEVsZW1lbnQ7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIHJldHVybiAib2JqZWN0IiA9PT0gKHZvaWQgMCA9PT0gdCA/ICJ1bmRlZmluZWQiIDogcih0KSkgJiYgMSA9PT0gdC5ub2RlVHlwZSAmJiAib2JqZWN0IiA9PT0gcih0LnN0eWxlKSAmJiAib2JqZWN0IiA9PT0gcih0Lm93bmVyRG9jdW1lbnQpOwogICAgfQogIH07Cn0sIGZ1bmN0aW9uICh0LCBlLCBuKSB7CiAgInVzZSBzdHJpY3QiOwoKICB0LmV4cG9ydHMgPSBmdW5jdGlvbiAodCkgewogICAgdmFyIGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpZnJhbWUiKTsKICAgIHJldHVybiBlLnNyYyA9IHQsIGUuc3R5bGUuY3NzVGV4dCA9ICJ3aWR0aDogMHB4OyBoZWlnaHQ6IDBweDsgZGlzcGxheTogbm9uZTsiLCAoZG9jdW1lbnQuYm9keSB8fCBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiYm9keSIpLml0ZW0oIjAiKSkuYXBwZW5kQ2hpbGQoZSksIGU7CiAgfTsKfSwgZnVuY3Rpb24gKHQsIGUsIG4pIHsKICAidXNlIHN0cmljdCI7CgogIHZhciByID0gbigwKS5ocmVmLAogICAgICBvID0gZnVuY3Rpb24gbyh0KSB7CiAgICB2YXIgZSA9IHQuc3BsaXQoIj8iKTsKICAgIGlmICgyICE9PSBlLmxlbmd0aCkgcmV0dXJuIHt9OwoKICAgIGZvciAodmFyIG4gPSBlWzFdICYmIGVbMV0uc3BsaXQoIiYiKSwgciA9IHt9LCBvID0gMDsgbyA8IG4ubGVuZ3RoOyBvKyspIHsKICAgICAgdmFyIGkgPSBuW29dLnNwbGl0KCI9Iik7CiAgICAgIGlbMV0gJiYgKHJbaVswXV0gPSBkZWNvZGVVUklDb21wb25lbnQoaVsxXSkpOwogICAgfQoKICAgIHJldHVybiByOwogIH0sCiAgICAgIGkgPSBmdW5jdGlvbiBpKCkgewogICAgZm9yICh2YXIgdCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJzY3JpcHQiKSwgZSA9IDA7IGUgPCB0Lmxlbmd0aDsgZSsrKSB7CiAgICAgIHZhciBuID0gdFtlXTsKICAgICAgaWYgKG4uc3JjLm1hdGNoKC9jYXB0Y2hhXC5qcy9pKSkgcmV0dXJuIG47CiAgICB9CiAgfTsKCiAgdC5leHBvcnRzID0gZnVuY3Rpb24gKCkgewogICAgdHJ5IHsKICAgICAgdmFyIHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiQ2FwdGNoYVNjcmlwdCIpIHx8IGkoKSB8fCAiIjsKICAgICAgaWYgKCF0KSByZXR1cm4gIiI7CiAgICAgIHZhciBlID0gdC5zcmMsCiAgICAgICAgICBuID0gbyhlKS5kb21haW47CiAgICAgIGlmIChuKSByZXR1cm4gbjsKICAgICAgdmFyIGEgPSAvKGh0dHBzP1w6XC9cL1swLTlhLXpBLVotOlwuXSspXC8vaSwKICAgICAgICAgIGMgPSBlLm1hdGNoKGEpIHx8IHIoKS5tYXRjaChhKTsKICAgICAgcmV0dXJuIGMgPyBjWzFdIDogIiI7CiAgICB9IGNhdGNoIChzKSB7CiAgICAgIHJldHVybiAiIjsKICAgIH0KICB9Owp9XSk7"},null]}